post_cb({"17542124": {"CommentCount": "0", "ViewCount": "120", "CreationDate": "2013-07-09T07:09:20.407", "LastActivityDate": "2013-07-09T07:27:35.953", "Title": "C++ strange value during calculation", "AcceptedAnswerId": "17542364", "PostTypeId": "1", "Id": "17542124", "Score": "0", "Body": "<p>I have the following line:</p>\n<pre><code>int iEndFrame = ((uByteStart + uByteCount-1) / g_iByteSize1FrameDecoded) + 1;\n</code></pre>\n<p>My values are:</p>\n<pre><code>uByteStart = 2147479808\nuByteCount = 8684\ng_iByteSize1FrameDecoded = 1920\n</code></pre>\n<p>However, iEndFrame becomes -1118477, and that can not be correct.</p>\n<p>Does anybody see my error?</p>\n<p>Thank you for the help!</p>\n<p>ps: \nThe declaration is:</p>\n<pre><code>void CApp::pCalcFrames(int uByteStart, int uByteCount, int &amp;uStartFrame, int &amp;uFramesToRead, int&amp; uOffset)\n</code></pre>\n", "Tags": "<c++><math>", "OwnerUserId": "1390192", "AnswerCount": "4"}, "17542150": {"ParentId": "17542124", "CommentCount": "0", "Body": "<p>Looks like an overflow. An <code>int</code> can't hold values larger than <code>INT_MAX</code>.</p>\n", "OwnerUserId": "15416", "PostTypeId": "2", "Id": "17542150", "Score": "1", "CreationDate": "2013-07-09T07:10:43.130", "LastActivityDate": "2013-07-09T07:10:43.130"}, "17542364": {"ParentId": "17542124", "CommentCount": "3", "Body": "<p>Like pointed in other answers, you have an integer overflow.</p>\n<p>It should be easily resolved in your case (assuming the final result can fit into <code>int</code>):</p>\n<p>Instead of:</p>\n<pre><code>int iEndFrame = ((uByteStart + uByteCount-1) / g_iByteSize1FrameDecoded) + 1;\n</code></pre>\n<p>do:</p>\n<pre><code>int iEndFrame = uByteStart / g_iByteSize1FrameDecoded + \n                uByteCount / g_iByteSize1FrameDecoded - 1 / g_iByteSize1FrameDecoded + 1;\n</code></pre>\n<p>Note the rounding though.</p>\n", "OwnerUserId": "1756636", "PostTypeId": "2", "Id": "17542364", "Score": "1", "CreationDate": "2013-07-09T07:24:11.043", "LastActivityDate": "2013-07-09T07:24:11.043"}, "17542202": {"ParentId": "17542124", "CommentCount": "0", "Body": "<p>Your <code>int</code>s are probably 32-bit wide. If so, your arithmetic calculations produce signed integer overflow, which triggers <em>undefined behavior</em>.</p>\n", "OwnerUserId": "187690", "PostTypeId": "2", "Id": "17542202", "Score": "1", "CreationDate": "2013-07-09T07:13:18.353", "LastActivityDate": "2013-07-09T07:13:18.353"}, "17542153": {"ParentId": "17542124", "PostTypeId": "2", "CommentCount": "0", "Body": "<p><code>uByteStart  + uByteCount</code> is wrapping around to negative since it's exceeding the size of an <code>int</code> on your platform (assume 32 bit).</p>\n<p>It's important not to do this as, technically, the behaviour is undefined so your code will not be portable:</p>\n<blockquote>\n<p id=\"so_17542124_17542153_0\">(\u00a75/5 C++03, \u00a75/4 C++11) If during the evaluation of an expression,\n  the result is not mathematically defined or not in the range of\n  representable values for its type, the behavior is undefined.</p>\n</blockquote>\n<p>One solution (but note it will not be as precise due to the truncation effects of successive integer divisions) would be to write</p>\n<pre><code>uByteStart / g_iByteSize1FrameDecoded + (uByteCount-1) / g_iByteSize1FrameDecoded + 1;\n</code></pre>\n<p>which reduces the size of the summation arguments.</p>\n", "OwnerUserId": "2380830", "LastEditorUserId": "2380830", "LastEditDate": "2013-07-09T07:27:35.953", "Id": "17542153", "Score": "2", "CreationDate": "2013-07-09T07:10:50.287", "LastActivityDate": "2013-07-09T07:27:35.953"}, "bq_ids": {"n4140": {"so_17542124_17542153_0": {"section_id": 5937, "quality": 0.8666666666666667, "length": 13}}, "n3337": {"so_17542124_17542153_0": {"section_id": 5709, "quality": 0.8666666666666667, "length": 13}}, "n4659": {"so_17542124_17542153_0": {"section_id": 7421, "quality": 0.8666666666666667, "length": 13}}}});