post_cb({"38343358": {"ViewCount": "88", "Body": "<p>The issue of variable declaration in <code>switch</code>-<code>case</code> statements is well discussed in <a href=\"https://stackoverflow.com/questions/92396/why-cant-variables-be-declared-in-a-switch-statement\">this SO post</a>, and the answers covered most of the aspects. But I faced a problem for that I couldn't find a solid reason. Can someone please explain what is wrong with this code?</p>\n<pre><code>switch (var)\n{\ncase 0:\n    int test;\n    test = 0;   // no error\n    int test2 = 0;  // ERROR: initialization of 'test2' is skipped by 'case' label\n    std::string str;\n    str = \"test\";   // ERROR: initialization of 'str' is skipped by 'case' label\n    break;\ncase 1:;\n    break;\n}\n</code></pre>\n<p>I know why the 6th line results in error. But what is wrong with the next two lines? I think this may have something to do with the difference between native types and class types, but I am not sure.</p>\n<p>This is not a duplicate question of <a href=\"https://stackoverflow.com/questions/92396/why-cant-variables-be-declared-in-a-switch-statement\">Why can't variables be declared in a switch statement?</a>! As I have provided a link to the original one. Please read the two questions and note the difference. AFAIK, issue is not discussed in the original question. </p>\n", "AcceptedAnswerId": "38343407", "Title": "Variable declaration in switch-case statements", "CreationDate": "2016-07-13T05:33:18.553", "Id": "38343358", "CommentCount": "0", "LastEditDate": "2017-05-23T12:22:33.747", "PostTypeId": "1", "LastEditorUserId": "-1", "LastActivityDate": "2016-07-17T16:57:14.353", "Score": "0", "OwnerUserId": "5358284", "Tags": "<c++><switch-statement><variable-declaration>", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_38343358_38343407_0": {"length": 40, "quality": 0.975609756097561, "section_id": 3918}}, "n3337": {"so_38343358_38343407_0": {"length": 40, "quality": 0.975609756097561, "section_id": 3778}}, "n4659": {"so_38343358_38343407_0": {"length": 41, "quality": 1.0, "section_id": 4804}}}, "38343407": {"Id": "38343407", "PostTypeId": "2", "Body": "<blockquote>\n<p id=\"so_38343358_38343407_0\">It is possible to transfer into a block, but not in a way that bypasses declarations with initialization. A\n  program that jumps 90 from a point where a variable with automatic storage duration is not in scope to a\n  point where it is in scope is ill-formed unless the variable has scalar type, class type with a trivial default\n  constructor and a trivial destructor, a cv-qualified version of one of these types, or an array of one of the\n  preceding types and is declared without an initializer (8.5).</p>\n</blockquote>\n<p>([stmt.dcl]/3)</p>\n<p>The intuitive explanation is that you can only skip a declaration if the initialization it performs is effectively a no-op. If a value is provided, you can't skip it. If there is any code in the constructor of a class, you can't skip it.</p>\n", "LastActivityDate": "2016-07-13T05:37:11.650", "CommentCount": "2", "CreationDate": "2016-07-13T05:37:11.650", "ParentId": "38343358", "Score": "1", "OwnerUserId": "481267"}});