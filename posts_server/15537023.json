post_cb({"15537023": {"CommentCount": "6", "AcceptedAnswerId": "15538759", "PostTypeId": "1", "LastEditorUserId": "141719", "CreationDate": "2013-03-20T23:54:36.040", "LastActivityDate": "2013-03-21T03:15:54.120", "LastEditDate": "2013-03-21T00:00:44.657", "ViewCount": "2822", "FavoriteCount": "1", "Title": "Declaration of method changes meaning of symbol", "Id": "15537023", "Score": "15", "Body": "<p>For the following code:</p>\n<pre><code>struct foo {};\n\nstruct A\n{\n    typedef foo foo_type;\n\n    void foo();\n};\n</code></pre>\n<p>GCC gives a compiler error:</p>\n<pre><code>test.cpp:7:14: error: declaration of 'void A::foo()' [-fpermissive]\n     void foo();\n              ^\ntest.cpp:1:8: error: changes meaning of 'foo' from 'struct foo' [-fpermissive]\n struct foo {};\n        ^\n</code></pre>\n<p>But clang accepts it without compiler errors. Who is right?</p>\n<p>Note that if the typedef is removed, or changed to <code>typedef ::foo foo_type</code>, both gcc and clang accept the code.</p>\n", "Tags": "<c++><name-resolution>", "OwnerUserId": "141719", "AnswerCount": "1"}, "15538759": {"ParentId": "15537023", "PostTypeId": "2", "CommentCount": "0", "Body": "<p>gcc is correct, but clang is not required to give a diagnostic (3.3.7):</p>\n<blockquote>\n<p id=\"so_15537023_15538759_0\">A name N used in a class S shall refer to the same declaration in its\n  context and when re-evaluated in the completed scope of S. No\n  diagnostic is required for a violation of this rule.</p>\n</blockquote>\n<p>This is because of how class scope works. The <code>foo</code> of <code>void foo();</code> is visible within the <strong>entire</strong> scope of the class <code>A</code>, so the declaration of <code>void foo();</code> changes the meaning of <code>foo</code> in the typedef from referring to <code>struct foo</code> to the name of the function <code>foo</code>.</p>\n", "OwnerUserId": "906773", "LastEditorUserId": "906773", "LastEditDate": "2013-03-21T03:15:54.120", "Id": "15538759", "Score": "16", "CreationDate": "2013-03-21T03:07:13.143", "LastActivityDate": "2013-03-21T03:15:54.120"}, "bq_ids": {"n4140": {"so_15537023_15538759_0": {"section_id": 7070, "quality": 1.0, "length": 15}}, "n3337": {"so_15537023_15538759_0": {"section_id": 6814, "quality": 1.0, "length": 15}}, "n4659": {"so_15537023_15538759_0": {"section_id": 8568, "quality": 1.0, "length": 15}}}});