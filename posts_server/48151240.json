post_cb({"48151240": {"ViewCount": "103", "Body": "<p>I'm wondering what happens to wchar_t* pointer after being used by WM_SETTEXT.</p>\n<pre><code>wchar_t* f = L\"test1\";\n    wchar_t* f2 = L\"test2\";\n    SendMessage(hWndEdit1, WM_SETTEXT, 0, (LPARAM)f);\n    // after some operations \n    SendMessage(hWndEdit1, WM_SETTEXT, 0, (LPARAM)f2);\n    delete f; // crashes\n</code></pre>\n<p>Why <strong>delete f;</strong> crashes?</p>\n", "AcceptedAnswerId": "48151339", "Title": "Why delete wchar_t pointer crashes?", "CreationDate": "2018-01-08T13:23:34.593", "Id": "48151240", "CommentCount": "5", "PostTypeId": "1", "LastActivityDate": "2018-01-08T13:52:35.580", "Score": "-2", "OwnerUserId": "997757", "Tags": "<c++><winapi>", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_48151240_48151339_0": {"length": 23, "quality": 1.0, "section_id": 6106}}, "n3337": {"so_48151240_48151339_0": {"length": 23, "quality": 1.0, "section_id": 5872}}, "n4659": {"so_48151240_48151339_0": {"length": 23, "quality": 1.0, "section_id": 7603}}}, "48151339": {"Id": "48151339", "PostTypeId": "2", "Body": "<p>You should remove this statement:</p>\n<pre><code>delete f; // crashes\n</code></pre>\n<p>You are causing <a href=\"http://en.cppreference.com/w/cpp/language/ub\" rel=\"nofollow noreferrer\">undefined behavior</a> by calling the <a href=\"http://en.cppreference.com/w/cpp/memory/new/operator_delete\" rel=\"nofollow noreferrer\">delete</a> operator on a pointer that was <strong>not</strong> <a href=\"http://en.cppreference.com/w/cpp/memory/new/operator_new\" rel=\"nofollow noreferrer\">new</a>-ed. You should only <code>delete</code> what you <code>new</code>-ed and <code>delete[]</code> what you <code>new[]</code>-ed. Excerpt from the <strong>n4140</strong> draft, paragraph <strong>5.3.5.2</strong>:</p>\n<blockquote>\n<p id=\"so_48151240_48151339_0\">the value of the operand of delete may be a null pointer value, a\n  pointer to a non-array object created by a previous new-expression, or\n  a pointer to a subobject (1.8) representing a base class of such an\n  object (Clause 10). If not, the behavior is undefined</p>\n</blockquote>\n<p>Note that in standard C++ you should apply a <code>const</code> qualifier when using pointers to string literals:</p>\n<pre><code>const wchar_t* f = L\"test\";\n</code></pre>\n<p>Or even better use the wide string:</p>\n<pre><code>std::wstring ws = L\"test\";\n</code></pre>\n", "LastEditorUserId": "8751754", "LastActivityDate": "2018-01-08T13:52:35.580", "Score": "1", "CreationDate": "2018-01-08T13:29:54.217", "ParentId": "48151240", "CommentCount": "10", "OwnerUserId": "8751754", "LastEditDate": "2018-01-08T13:52:35.580"}});