post_cb({"bq_ids": {"n4140": {"so_32623906_32624191_2": {"length": 14, "quality": 1.0, "section_id": 6185}, "so_32623906_32624191_3": {"length": 11, "quality": 0.7857142857142857, "section_id": 6185}}, "n3337": {"so_32623906_32624191_3": {"length": 10, "quality": 0.7142857142857143, "section_id": 5946}}, "n4659": {"so_32623906_32624191_0": {"length": 6, "quality": 0.6, "section_id": 7687}, "so_32623906_32624191_2": {"length": 11, "quality": 0.7857142857142857, "section_id": 7687}, "so_32623906_32624191_3": {"length": 10, "quality": 0.7142857142857143, "section_id": 7687}}}, "32623906": {"ViewCount": "276", "Body": "<pre><code>#include &lt;iostream&gt;\n\nunion gc_bits {\n    size_t value;\n    struct {\n        size_t arena : 2;\n    } bits;\n\n    constexpr gc_bits(size_t value_) : value(value_) {\n    }\n};\n\nstatic constexpr size_t get_max_arenas() {\n    return gc_bits(~0ULL).bits.arena;\n}\n\nsize_t current_colour[get_max_arenas()]; // error\n\nint main() {\n    std::cout &lt;&lt; get_max_arenas() &lt;&lt; std::endl;\n}\n</code></pre>\n<p>The array declaration errors out because get_max_arenas is not a constexpr. I'm not clear on why this should be so. </p>\n", "AcceptedAnswerId": "32624191", "Title": "Why is this not a constexpr?", "CreationDate": "2015-09-17T06:35:00.203", "Id": "32623906", "CommentCount": "12", "LastEditDate": "2016-05-02T16:31:00.920", "PostTypeId": "1", "LastEditorUserId": "718379", "LastActivityDate": "2016-05-02T16:31:00.920", "Score": "6", "OwnerUserId": "2131", "Tags": "<c++><c++11><unions><constexpr>", "AnswerCount": "1"}, "32624191": {"Id": "32624191", "PostTypeId": "2", "Body": "<p>Slightly rephrasing your program:</p>\n<pre><code>static constexpr auto gma = get_max_arenas();\n\nsize_t current_colour[gma]; // error\n</code></pre>\n<p>gives the Clang error:</p>\n<blockquote>\n<p id=\"so_32623906_32624191_0\">read of member 'bits' of union with active member 'value' is not\n  allowed in a constant expression</p>\n</blockquote>\n<p>The reason you get this error is that the constructor sets the <code>value</code>, and then you try to read <code>bits</code>. This is not allowed, as commented by @gurka.</p>\n<p><a href=\"http://open-std.org/JTC1/SC22/WG21/docs/papers/2015/n4527.pdf\"><strong>Standard</strong></a> quote:</p>\n<blockquote>\n<p id=\"so_32623906_32624191_1\"><strong>[expr.const]</strong></p>\n<p id=\"so_32623906_32624191_2\">2 A conditional-expression e is a core constant expression <strong>unless</strong> the\n  evaluation of e, following the rules of the abstract machine (1.9),\n  would evaluate one of the following expressions:</p>\n<p id=\"so_32623906_32624191_3\">(2.8) \u2014 an lvalue-to-rvalue conversion (4.1) or modification (5.18,\n  5.2.6, 5.3.2) that is applied to a glvalue that refers to <strong>a non-active member of a union</strong> or a subobject thereof;</p>\n</blockquote>\n", "LastEditorUserId": "819272", "LastActivityDate": "2015-09-17T07:00:00.950", "Score": "7", "CreationDate": "2015-09-17T06:54:13.970", "ParentId": "32623906", "CommentCount": "8", "OwnerUserId": "819272", "LastEditDate": "2015-09-17T07:00:00.950"}});