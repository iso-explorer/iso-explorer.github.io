post_cb({"21903741": {"CommentCount": "4", "ViewCount": "871", "PostTypeId": "1", "LastEditorUserId": "1142881", "CreationDate": "2014-02-20T09:38:01.763", "LastActivityDate": "2017-08-21T12:13:26.163", "Title": "Fail to find class after creating a JVM from C++ application via JNI", "AcceptedAnswerId": "21904148", "LastEditDate": "2014-02-20T10:09:14.300", "Id": "21903741", "Score": "1", "Body": "<p>Using JNI I'm trying to create an instance of a Java class from a C++ project but it fails. I have tested the same code with a simple Java class and it works. The difference is that my actual classpath is a directory containing a bunch of jars. The class I need instantiating <code>CmaesClient</code> belongs to one of those jars.</p>\n<p>This is the C++ code:</p>\n<pre><code>JavaVM* jvm = NULL;\nJNIEnv *env = NULL;\nJavaVMInitArgs vm_args;\nJavaVMOption* options = new JavaVMOption[1];\noptions[0].optionString = \"-Djava.class.path=/home/azg/code/hpcmom/target/1.1.9-SNAPSHOT/hpcmom-cmaes\";\nvm_args.version = JNI_VERSION_1_6;\nvm_args.nOptions = 1;\nvm_args.options = options;\nvm_args.ignoreUnrecognized = JNI_TRUE;\nJNI_GetDefaultJavaVMInitArgs(&amp;vm_args);\nJNI_CreateJavaVM(&amp;jvm, (void**) &amp;env, &amp;vm_args);\nif (jvm == NULL) {\n    std::cout &lt;&lt; \"Failed creating JVM\" &lt;&lt; std::endl;\n} else {\n    std::cout &lt;&lt; \"Succeeded creating JVM\" &lt;&lt; std::endl;\n}\njclass clazz = env-&gt;FindClass(\"com.sfoam.hpcmom.cmaes.CmaesClient\");\nif (clazz == NULL) {\n    std::cout &lt;&lt; \"Failed creating CmaesClient\" &lt;&lt; std::endl;\n} else {\n    std::cout &lt;&lt; \"Succeeded creating CmaesClient\" &lt;&lt; std::endl;\n}\njmethodID constr = env-&gt;GetMethodID(clazz, \"&lt;init&gt;\", \"([Ljava/lang/String;)V\");\n        jstring jarPath = env-&gt;NewStringUTF(\"/home/azg/code/hpcmom/target/1.1.9-SNAPSHOT/hpcmom-cmaes/hpcmom-cmaes-1.1.9-SNAPSHOT.jar\");\njobject object = env-&gt;NewObject(clazz, constr, jarPath);\ndelete options;\njvm-&gt;DestroyJavaVM();\n</code></pre>\n<p>and the error meaning it could not find the class, therefore seems something wrong loading the classes or?</p>\n<pre><code>Succeeded creating JVM\nFailed creating CmaesClient\n#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x00007f5601067214, pid=25496, tid=140007371831104\n#\n# JRE version: Java(TM) SE Runtime Environment (7.0_51-b13) (build 1.7.0_51-b13)\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (24.51-b03 mixed mode linux-amd64 compressed oops)\n# Problematic frame:\n# V  [libjvm.so+0x645214]  get_method_id(JNIEnv_*, _jclass*, char const*, char const*, bool, Thread*)+0x84\n#\n# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again\n#\n# An error report file with more information is saved as:\n# /home/azg/code/sfoml/debug/hs_err_pid25496.log\n#\n# If you would like to submit a bug report, please visit:\n#   http://bugreport.sun.com/bugreport/crash.jsp\n#\nAborted (core dumped)\n</code></pre>\n<p>The directory <code>/home/azg/code/hpcmom/target/1.1.9-SNAPSHOT/hpcmom-cmaes</code> contains all the needed jars.</p>\n", "Tags": "<java><c++><jvm><jni>", "OwnerUserId": "1142881", "AnswerCount": "1"}, "21904148": {"ParentId": "21903741", "PostTypeId": "2", "CommentCount": "1", "Body": "<p><a href=\"http://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/functions.html\" rel=\"nofollow noreferrer\">JNI Functions</a></p>\n<blockquote>\n<p id=\"so_21903741_21904148_0\"><code>name</code>: a fully-qualified class name (that is, a package name, <strong>delimited\n  by \u201c<code>/</code>\u201d</strong>, followed by the class name).</p>\n</blockquote>\n<p>Change</p>\n<pre class=\"lang-java prettyprint-override\"><code>env-&gt;FindClass(\"com.sfoam.hpcmom.cmaes.CmaesClient\");\n</code></pre>\n<p>to</p>\n<pre class=\"lang-java prettyprint-override\"><code>env-&gt;FindClass(\"com/sfoam/hpcmom/cmaes/CmaesClient\");\n</code></pre>\n<p>(I.e. replace each <code>.</code> with <code>/</code>).</p>\n", "OwnerUserId": "1052842", "LastEditorUserId": "1052842", "LastEditDate": "2017-08-21T12:13:26.163", "Id": "21904148", "Score": "3", "CreationDate": "2014-02-20T09:53:40.033", "LastActivityDate": "2017-08-21T12:13:26.163"}, "bq_ids": {"n4140": {"so_21903741_21904148_0": {"section_id": 191, "quality": 0.6, "length": 6}}, "n3337": {"so_21903741_21904148_0": {"section_id": 185, "quality": 0.6, "length": 6}}, "n4659": {"so_21903741_21904148_0": {"section_id": 196, "quality": 0.6, "length": 6}}}});