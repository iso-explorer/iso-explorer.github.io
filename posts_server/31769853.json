post_cb({"31769853": {"CommentCount": "4", "ViewCount": "367", "CreationDate": "2015-08-02T08:10:07.473", "LastActivityDate": "2015-08-02T09:41:29.823", "Title": "C++ class name injection", "AcceptedAnswerId": "31770521", "PostTypeId": "1", "Id": "31769853", "Score": "4", "Body": "<p>According to the standard [class]/2:</p>\n<blockquote>\n<p id=\"so_31769853_31769853_0\">\u2026 The class-name is also inserted into the scope of the class itself; this is known as the <em>injected-class-name</em>.\u2026</p>\n</blockquote>\n<p>Moreover, [basic.scope.pdecl]/9:</p>\n<blockquote>\n<p id=\"so_31769853_31769853_1\">The point of declaration for an <em>injected-class-name</em> (Clause 9) is immediately following the opening brace of the class definition.</p>\n</blockquote>\n<p>Finally, [basic.lookup.classref]/3 and its example:</p>\n<blockquote>\n<p id=\"so_31769853_31769853_2\">If the unqualified-id is ~ <em>type-name</em>, the <em>type-name</em> is looked up \u2026</p>\n</blockquote>\n<pre><code>struct A { };\nstruct B {\n    struct A { };\n    void f(::A* a);\n};\nvoid B::f(::A* a) {\n    a-&gt; ~ A(); // OK: lookup in *a finds the injected-class-name\n}\n</code></pre>\n<p>So far, we can gather:</p>\n<ol>\n<li>In the scope of a class A, there exists a name A.</li>\n<li>That name is declared at the opening of the definition brace of class A.</li>\n<li>That name names a type.</li>\n</ol>\n<p>If the above is correct, then <strong>why does the following code fails to compile</strong> (in MSVC2015):</p>\n<pre><code>struct inj\n{};\n\ntypedef struct inj::inj inj2;\n</code></pre>\n<p>The error message </p>\n<blockquote>\n<p id=\"so_31769853_31769853_3\">Error C2039   '{ctor}': is not a member of 'inj'</p>\n</blockquote>\n<p>seems to be at odds with the standard:</p>\n<blockquote>\n<p id=\"so_31769853_31769853_4\">Note: For example, the constructor is not an acceptable lookup result in an elaborated-type-specifier so the constructor would not be used in place\n  of the injected-class-name. \u2014end note</p>\n</blockquote>\n", "Tags": "<c++><c++11><language-lawyer>", "OwnerUserId": "2549876", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_31769853_31769853_0": {"section_id": 5846, "quality": 0.9, "length": 9}, "so_31769853_31769853_2": {"section_id": 7128, "quality": 1.0, "length": 4}, "so_31769853_31769853_1": {"section_id": 7056, "quality": 0.9090909090909091, "length": 10}, "so_31769853_31769853_4": {"section_id": 7114, "quality": 0.7142857142857143, "length": 10}}, "n3337": {"so_31769853_31769853_0": {"section_id": 5616, "quality": 0.9, "length": 9}, "so_31769853_31769853_2": {"section_id": 6872, "quality": 1.0, "length": 4}, "so_31769853_31769853_1": {"section_id": 6800, "quality": 0.9090909090909091, "length": 10}, "so_31769853_31769853_4": {"section_id": 6858, "quality": 0.7142857142857143, "length": 10}}, "n4659": {"so_31769853_31769853_0": {"section_id": 7325, "quality": 0.9, "length": 9}, "so_31769853_31769853_2": {"section_id": 8629, "quality": 1.0, "length": 4}, "so_31769853_31769853_1": {"section_id": 8553, "quality": 0.9090909090909091, "length": 10}, "so_31769853_31769853_4": {"section_id": 8615, "quality": 0.7142857142857143, "length": 10}}}, "31770521": {"ParentId": "31769853", "PostTypeId": "2", "CommentCount": "1", "Body": "<p>Since the following code compiles and runs correctly in other compilers, it is a bug in MSVC2015.</p>\n<pre><code>#include &lt;boost/type_index.hpp&gt;\n#include &lt;iostream&gt;\n\nstruct inj\n{\n    int g;\n};\n\ntypedef struct inj::inj inj2;\n\nint main()\n{\n\n    inj2 ii;\n    std::cout &lt;&lt; boost::typeindex::type_id_with_cvr&lt;decltype(ii)&gt;().pretty_name() &lt;&lt; '\\n';\n}\n</code></pre>\n<hr>\n<p>UPDATE: <a href=\"https://connect.microsoft.com/VisualStudio/feedback/details/1618414\" rel=\"noreferrer\">Reported as bug</a>.</p>\n</hr>", "OwnerUserId": "2549876", "LastEditorUserId": "2549876", "LastEditDate": "2015-08-02T09:41:29.823", "Id": "31770521", "Score": "6", "CreationDate": "2015-08-02T09:34:09.347", "LastActivityDate": "2015-08-02T09:41:29.823"}});