post_cb({"17667202": {"CommentCount": "1", "CreationDate": "2013-07-16T02:50:07.683", "PostTypeId": "1", "AcceptedAnswerId": "17667357", "LastEditorUserId": "1196603", "LastActivityDate": "2014-07-06T17:15:23.117", "LastEditDate": "2014-07-06T17:15:23.117", "ViewCount": "1968", "FavoriteCount": "1", "Title": "Is C++ std::queue safe if there are a pushing-only thread and a popping-only thread?", "Id": "17667202", "Score": "4", "Body": "<p>I wonder if this situation is (thread-)safe or not.</p>\n<p>There is a thread that only pushes to a std::queue.<br/>\nAnd there is another thread that only pops from the std::queue.<br/>\nSince whether the queue is empty or not, is managed thread-safely, the later thread won't fail popping.</p>\n<p>Could you help me, please?</p>\n<p>Thank you.</p>\n", "Tags": "<c++><multithreading><thread-safety><queue>", "OwnerUserId": "2182622", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_17667202_17667357_0": {"section_id": 717, "quality": 0.9259259259259259, "length": 25}}, "n3337": {"so_17667202_17667357_0": {"section_id": 706, "quality": 0.9259259259259259, "length": 25}}, "n4659": {"so_17667202_17667357_0": {"section_id": 748, "quality": 0.9259259259259259, "length": 25}}}, "17667357": {"ParentId": "17667202", "CommentCount": "0", "Body": "<p>I believe the answer is no.</p>\n<p>The standard says (\u00a723.2.2/1):</p>\n<blockquote>\n<p id=\"so_17667202_17667357_0\">For purposes of avoiding data races (17.6.5.9), implementations shall consider the following functions to be const: begin, end, rbegin, rend, front, back, data, find, lower_bound, upper_bound, equal_range, at and, except in associative or unordered associative containers, operator[].</p>\n</blockquote>\n<p>At least as I'd interpret things (and <a href=\"http://channel9.msdn.com/posts/C-and-Beyond-2012-Herb-Sutter-You-dont-know-blank-and-blank\">Herb Sutter seems to agree</a>) that means those functions (and <em>only</em> those functions) can be treated as \"thread safe\". Push and pop aren't on the list, so you can't assume they're thread safe.</p>\n<p>I'd also add that even popping will actually write data -- when you pop an item from the container, the size of the container needs to be updated, so both pushing and popping do writing. When more than one thread does writing, you need to do something to ensure only one thread does it at a time.</p>\n<p>To summarize: sorry, but no.</p>\n", "OwnerUserId": "179910", "PostTypeId": "2", "Id": "17667357", "Score": "9", "CreationDate": "2013-07-16T03:07:09.953", "LastActivityDate": "2013-07-16T03:07:09.953"}});