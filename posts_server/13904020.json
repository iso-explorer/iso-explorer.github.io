post_cb({"13904020": {"CommentCount": "7", "ViewCount": "330", "PostTypeId": "1", "LastEditorUserId": "636019", "CreationDate": "2012-12-16T18:02:41.060", "LastActivityDate": "2012-12-17T11:45:05.687", "Title": "A BIG bug of VC++? Why does initializer-list not value-initialize a struct?", "LastEditDate": "2012-12-17T05:48:44.863", "Id": "13904020", "Score": "7", "Body": "<p>The C++11 standard 8.5.4.3 says: </p>\n<p>\"If the initializer list has no elements and T is a class type with a default constructor, the object is value-initialized.\"</p>\n<pre><code>struct A\n{\n    int get() { return i; }\n\nprivate:\n    int i;\n};\n\nint main()\n{\n    A a = {};\n\n    int n = a.get();\n    cout &lt;&lt; n &lt;&lt; endl;\n    // n is a random number rather than 0\n\n    return 0;\n}\n</code></pre>\n<p>Is this a bug of VC++? My VC++ is the latest Nov 2012 CTP.</p>\n", "Tags": "<c++><c++11><initialization><aggregate><initializer-list>", "OwnerUserId": "508343", "AnswerCount": "1"}, "13913553": {"ParentId": "13904020", "CommentCount": "2", "CreationDate": "2012-12-17T11:45:05.687", "OwnerUserId": "567292", "PostTypeId": "2", "Id": "13913553", "Score": "3", "Body": "<p>Value-initialization of a non-aggregate class type is covered by 8.5p8.  In your case the (non-union) class has an implicitly-declared defaulted default no-parameter constructor (12.1p5), which is not deleted and is trivial (ibid).  Thus the second bullet of 8.5p8 applies:</p>\n<blockquote>\n<p id=\"so_13904020_13913553_0\">\u2014 if <code>T</code> is a (possibly cv-qualified) non-union class type without a user-provided or deleted default constructor, then the object is zero-initialized and, if <code>T</code> has a non-trivial default constructor, default-initialized;</p>\n</blockquote>\n<p>So <code>A</code> should be zero-initialized, and the program should print <code>0</code>.</p>\n<p>On the following program:</p>\n<pre><code>struct A { int get() { return i; } private: int i; };\n#include &lt;iostream&gt;\nint main() {\n    char c[sizeof(A)];\n    new (c) int{42};\n    std::cout &lt;&lt; (new (c) A{})-&gt;get() &lt;&lt; '\\n';\n}\n</code></pre>\n<p>gcc-4.7.2 correctly outputs <code>0</code>; gcc-4.6.3 incorrectly outputs <code>42</code>; clang-3.0 goes absolutely crazy and outputs garbage (e.g. <code>574874232</code>).</p>\n", "LastActivityDate": "2012-12-17T11:45:05.687"}, "bq_ids": {"n4140": {"so_13904020_13913553_0": {"section_id": 3287, "quality": 0.9375, "length": 15}}, "n3337": {"so_13904020_13913553_0": {"section_id": 3157, "quality": 0.6875, "length": 11}}, "n4659": {"so_13904020_13913553_0": {"section_id": 4049, "quality": 0.9375, "length": 15}}}});