post_cb({"bq_ids": {"n4140": {"so_47165384_47165639_1": {"length": 17, "quality": 1.0, "section_id": 5950}, "so_47165384_47165639_0": {"length": 45, "quality": 1.0, "section_id": 5949}}, "n3337": {"so_47165384_47165639_1": {"length": 17, "quality": 1.0, "section_id": 5720}, "so_47165384_47165639_0": {"length": 45, "quality": 1.0, "section_id": 5719}}, "n4659": {"so_47165384_47165639_1": {"length": 16, "quality": 0.9411764705882353, "section_id": 7436}, "so_47165384_47165639_0": {"length": 44, "quality": 0.9777777777777777, "section_id": 7435}}}, "47165384": {"ViewCount": "396", "Body": "<pre><code>class C {\n  auto (*foo)() -&gt; decltype(this);\n};\n</code></pre>\n<p>This code is accepted by GCC, MSVC, and clang, but not icc.</p>\n", "AcceptedAnswerId": "47165639", "Title": "Is this function pointer with `this` in trailing return type legal?", "CreationDate": "2017-11-07T18:49:02.890", "Id": "47165384", "CommentCount": "3", "FavoriteCount": "5", "PostTypeId": "1", "LastEditDate": "2017-11-12T11:35:33.407", "LastEditorUserId": "5456631", "LastActivityDate": "2017-11-12T11:35:33.407", "Score": "11", "OwnerUserId": "8213872", "Tags": "<c++><c++11><language-lawyer><function-pointers>", "AnswerCount": "1"}, "47165639": {"Id": "47165639", "PostTypeId": "2", "Body": "<p>Quoting n4140 (roughly C++14) [expr.prim.general]:</p>\n<blockquote>\n<p id=\"so_47165384_47165639_0\">3 If a declaration declares a member function or member function template of a class <code>X</code>, the expression <code>this</code> is a prvalue of type \"pointer to <em>cv-qualifier-seq</em> <code>X</code>\" between the optional <em>cv-qualifer-seq</em> and the end of the <em>function-definition</em>, <em>member-declarator</em>, or <em>declarator</em>. It shall not appear before the optional <em>cv-qualifier-seq</em> and it shall not appear within the declaration of a static member function (although its type and value category are defined within a static member function as they are within a non-static member function). [...]</p>\n<p id=\"so_47165384_47165639_1\">4 Otherwise, if a <em>member-declarator</em> declares a non-static data member (9.2) of a class <code>X</code>, the expression this is a prvalue of type \"pointer to <code>X</code>\" within the optional <em>brace-or-equal-initializer</em>. It shall not appear elsewhere in the <em>member-declarator</em>.</p>\n</blockquote>\n<p>Since you're not declaring a member function or member function template, p3 doesn't apply, but this is what would make the code valid for the non-pointer case where you actually declare a member function: the trailing return type is between the optional <em>cv-qualifier-seq</em> and the end of the declarator, as made clearer in the definition of a <code>const</code> member function:</p>\n<pre><code>auto foo() const -&gt; decltype(this) { }\n</code></pre>\n<p>p4 is what applies here though. It allows <code>this</code> only to appear in the initialiser. You're putting it elsewhere. p3 doesn't apply, so ICC is correct to reject this.</p>\n", "LastEditorUserId": "743382", "LastActivityDate": "2017-11-07T19:13:58.150", "Score": "7", "CreationDate": "2017-11-07T19:04:42.530", "ParentId": "47165384", "CommentCount": "2", "LastEditDate": "2017-11-07T19:13:58.150", "OwnerUserId": "743382"}});