post_cb({"46455917": {"ParentId": "15718262", "PostTypeId": "2", "CommentCount": "0", "Body": "<p>In C11 the rule is never called by that name. However C, just like C++, defines the behaviour in terms of abstract machine. The as-if rule is in <a href=\"http://port70.net/~nsz/c/c11/n1570.html#5.1.2.3\" rel=\"nofollow noreferrer\">C11 5.1.2.3p6</a>:</p>\n<blockquote>\n<ol start=\"6\">\n<li><p id=\"so_15718262_46455917_0\">The least requirements on a conforming implementation are:</p>\n<ul>\n<li>Accesses to <code>volatile</code> objects are evaluated strictly according to the rules of the abstract machine.</li>\n<li>At program termination, all data written into files shall be identical to the result that execution of the program according to the abstract semantics would have produced.</li>\n<li>The input and output dynamics of interactive devices shall take place as specified in <a href=\"http://port70.net/~nsz/c/c11/n1570.html#7.21.3\" rel=\"nofollow noreferrer\">7.21.3</a>. The intent of these requirements is that unbuffered or line-buffered output appear as soon as possible, to ensure that prompting messages actually appear prior to a program waiting for input. </li>\n</ul>\n<p id=\"so_15718262_46455917_1\">\u00a0</p>\n<p id=\"so_15718262_46455917_2\">This is the observable behavior of the program.</p></li>\n</ol>\n</blockquote>\n", "OwnerUserId": "918959", "LastEditorUserId": "918959", "LastEditDate": "2017-09-27T19:45:20.613", "Id": "46455917", "Score": "4", "CreationDate": "2017-09-27T19:36:09.667", "LastActivityDate": "2017-09-27T19:45:20.613"}, "15718279": {"ParentId": "15718262", "PostTypeId": "2", "CommentCount": "27", "Body": "<h1><strong>What is the \"<em>as-if</em>\" rule?</strong></h1>\n<p>The \"<em>as-if</em>\" rule basically defines what transformations an implementation is allowed to perform on a legal C++ program. In short, all transformations that do not affect a program's \"<em>observable behavior</em>\" (see below for a precise definition) are allowed. </p>\n<p>The goal is to give implementations freedom to perform optimizations as long as the behavior of the program remains compliant with the semantics specified by the C++ Standard in terms of an abstract machine.</p>\n<hr>\n<h1><strong>Where does the Standard introduce this rule?</strong></h1>\n<p>The C++11 Standard introduces the \"<em>as-if</em>\" rule in Paragraph 1.9/1:</p>\n<blockquote>\n<p id=\"so_15718262_15718279_0\">The semantic descriptions in this International Standard define a parameterized nondeterministic abstract\n  machine. This International Standard places no requirement on the structure of conforming implementations.\n  In particular, they need not copy or emulate the structure of the abstract machine. Rather, conforming\n  implementations are required to emulate (only) the <strong>observable behavior</strong> of the abstract machine as explained\n  below.</p>\n</blockquote>\n<p>Also, an explanatory footnote adds:</p>\n<blockquote>\n<p id=\"so_15718262_15718279_1\"><strong>This provision is sometimes called the \u201cas-if\u201d rule</strong>, because an implementation is free to disregard any requirement of this\n  International Standard as long as the result is as if the requirement had been obeyed, as far as can be determined from the\n  observable behavior of the program. For instance, an actual implementation need not evaluate part of an expression if it can\n  deduce that its value is not used and that no side effects affecting the observable behavior of the program are produced.</p>\n</blockquote>\n<hr>\n<h1><strong>What does the rule mandate exactly?</strong></h1>\n<p>Paragraph 1.9/5 further specifies:</p>\n<blockquote>\n<p id=\"so_15718262_15718279_2\">A conforming implementation <strong><em>executing a well-formed program</em> shall produce the same observable behavior\n  as one of the possible executions of the corresponding instance of the abstract machine with the same program\n  and the same input</strong>. However, if any such execution contains an undefined operation, this International\n  Standard places no requirement on the implementation executing that program with that input (not even\n  with regard to operations preceding the first undefined operation).</p>\n</blockquote>\n<p>It is worth stressing that this constraint applies when <em>\"executing a well-formed program\"</em> only, and that the possible outcomes of executing a program which contains undefined behavior are unconstrained. This is made explicit in Paragraph 1.9/4 as well:</p>\n<blockquote>\n<p id=\"so_15718262_15718279_3\">Certain other operations are described in this International Standard as undefined (for example, the effect\n  of attempting to modify a const object). [ Note: <strong>This International Standard imposes no requirements on\n  the behavior of programs that contain undefined behavior</strong>. \u2014end note ]</p>\n</blockquote>\n<p>Finally, concerning the definition of \"<em>observable behavior</em>\", Paragraph 1.9/8 goes as follows:</p>\n<blockquote>\n<p id=\"so_15718262_15718279_4\">The least requirements on a conforming implementation are:</p>\n<p id=\"so_15718262_15718279_5\">\u2014 Access to volatile objects are evaluated strictly according to the rules of the abstract machine.</p>\n<p id=\"so_15718262_15718279_6\">\u2014 At program termination, all data written into files shall be identical to one of the possible results that\n  execution of the program according to the abstract semantics would have produced.</p>\n<p id=\"so_15718262_15718279_7\">\u2014 The input and output dynamics of interactive devices shall take place in such a fashion that prompting\n  output is actually delivered before a program waits for input. What constitutes an interactive device\n  is implementation-defined.</p>\n<p id=\"so_15718262_15718279_8\"><strong>These collectively are referred to as the observable behavior of the program</strong>. [ <em>Note</em>: More stringent\n  correspondences between abstract and actual semantics may be defined by each implementation. \u2014<em>end\n  note</em> ]</p>\n</blockquote>\n<hr>\n<h1><strong>Are there situations where this rule does not apply?</strong></h1>\n<p>To the best of my knowledge, the only exception to the \"<em>as-if</em>\" rule is copy/move elision, which is allowed even though the copy constructor, move constructor, or destructor of a class have side effects. The exact conditions for this are specified in Paragraph 12.8/31:</p>\n<blockquote>\n<p id=\"so_15718262_15718279_9\">When certain criteria are met, an implementation is allowed to omit the copy/move construction of a class\n  object, <strong>even if the constructor selected for the copy/move operation and/or the destructor for the object\n  have side effects</strong>. [...]</p>\n</blockquote>\n</hr></hr></hr>", "OwnerUserId": "1932150", "LastEditorUserId": "1932150", "LastEditDate": "2013-03-30T15:15:07.463", "Id": "15718279", "Score": "70", "CreationDate": "2013-03-30T11:59:27.263", "LastActivityDate": "2013-03-30T15:15:07.463"}, "15718262": {"CommentCount": "1", "AcceptedAnswerId": "15718279", "CreationDate": "2013-03-30T11:57:32.053", "LastActivityDate": "2017-09-27T19:45:20.613", "PostTypeId": "1", "ViewCount": "5045", "FavoriteCount": "25", "Title": "What exactly is the \"as-if\" rule?", "Id": "15718262", "Score": "62", "Body": "<p>As the title says,     </p>\n<blockquote>\n<p id=\"so_15718262_15718262_0\"><strong><a href=\"http://en.cppreference.com/w/cpp/language/as_if\">What exactly is the \"as-if\" rule?</a></strong> </p>\n</blockquote>\n<p>An typical answer one would get is:    </p>\n<blockquote>\n<p id=\"so_15718262_15718262_1\">The rule that allows any and all code transformations that do not change the observable behavior of the program</p>\n</blockquote>\n<p>From time to time we keep getting behaviors from certain implementations which are attributed to this rule. Many a times wrongly. So, What exactly is this rule. The standard does not clearly mention this rule as a section or paragraph, so what exactly falls under the purview of this rule? To me it seems like a grey area which is not defined in detail by the standard. Can someone elaborate on the details citing the references from the standard.</p>\n<p><sup>Note: Tagging this as C and C++ both, because it is relevant to both languages.</sup></p>\n", "Tags": "<c++><c><optimization>", "OwnerUserId": "452307", "AnswerCount": "2"}, "bq_ids": {"n4140": {"so_15718262_15718279_3": {"section_id": 5800, "quality": 0.7692307692307693, "length": 20}, "so_15718262_15718279_2": {"section_id": 5801, "quality": 0.9736842105263158, "length": 37}, "so_15718262_15718279_7": {"section_id": 5804, "quality": 0.9090909090909091, "length": 20}, "so_15718262_15718279_5": {"section_id": 5804, "quality": 1.0, "length": 9}, "so_15718262_15718279_4": {"section_id": 5804, "quality": 0.8, "length": 4}, "so_15718262_15718279_9": {"section_id": 480, "quality": 1.0, "length": 22}, "so_15718262_15718279_0": {"section_id": 5797, "quality": 0.8918918918918919, "length": 33}, "so_15718262_15718279_1": {"section_id": 5797, "quality": 0.9285714285714286, "length": 39}, "so_15718262_46455917_0": {"section_id": 5804, "quality": 0.8, "length": 4}, "so_15718262_15718279_8": {"section_id": 5804, "quality": 0.6842105263157895, "length": 13}, "so_15718262_15718279_6": {"section_id": 5804, "quality": 1.0, "length": 17}}, "n3337": {"so_15718262_15718279_3": {"section_id": 5573, "quality": 0.7692307692307693, "length": 20}, "so_15718262_15718279_2": {"section_id": 5574, "quality": 0.9736842105263158, "length": 37}, "so_15718262_15718279_7": {"section_id": 5577, "quality": 0.9090909090909091, "length": 20}, "so_15718262_15718279_5": {"section_id": 5577, "quality": 1.0, "length": 9}, "so_15718262_15718279_4": {"section_id": 5577, "quality": 0.8, "length": 4}, "so_15718262_15718279_9": {"section_id": 471, "quality": 0.8636363636363636, "length": 19}, "so_15718262_15718279_0": {"section_id": 5570, "quality": 0.8918918918918919, "length": 33}, "so_15718262_15718279_1": {"section_id": 5570, "quality": 0.9285714285714286, "length": 39}, "so_15718262_46455917_0": {"section_id": 5577, "quality": 0.8, "length": 4}, "so_15718262_15718279_8": {"section_id": 5577, "quality": 0.6842105263157895, "length": 13}, "so_15718262_15718279_6": {"section_id": 5577, "quality": 1.0, "length": 17}}, "n4659": {"so_15718262_15718279_3": {"section_id": 7259, "quality": 0.7692307692307693, "length": 20}, "so_15718262_15718279_2": {"section_id": 7260, "quality": 0.9736842105263158, "length": 37}, "so_15718262_15718279_7": {"section_id": 7262, "quality": 0.9090909090909091, "length": 20}, "so_15718262_15718279_8": {"section_id": 7262, "quality": 0.6842105263157895, "length": 13}, "so_15718262_15718279_4": {"section_id": 7262, "quality": 0.8, "length": 4}, "so_15718262_15718279_9": {"section_id": 502, "quality": 1.0, "length": 22}, "so_15718262_15718279_0": {"section_id": 7256, "quality": 0.8918918918918919, "length": 33}, "so_15718262_15718279_1": {"section_id": 7256, "quality": 0.9285714285714286, "length": 39}, "so_15718262_46455917_0": {"section_id": 7262, "quality": 0.8, "length": 4}, "so_15718262_15718279_5": {"section_id": 7262, "quality": 0.7777777777777778, "length": 7}, "so_15718262_15718279_6": {"section_id": 7262, "quality": 1.0, "length": 17}}}});