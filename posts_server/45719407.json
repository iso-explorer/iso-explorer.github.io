post_cb({"45719751": {"ParentId": "45719407", "CommentCount": "0", "Body": "<blockquote>\n<p id=\"so_45719407_45719751_0\">\u00a7 9.4.2 Static data members [class.static.data]</p>\n<ol start=\"3\">\n<li><p id=\"so_45719407_45719751_1\">If a non-volatile const static data member is of integral or enumeration type, its declaration in the class definition can specify\n  a brace-or-equal-initializer [...] The\n  member <strong>shall still be defined in a namespace scope if it is odr-used</strong>\n  (3.2) in the program and the namespace scope definition shall not\n  contain an initializer.</p></li>\n<li><p id=\"so_45719407_45719751_2\">[ Note: There shall be <strong>exactly one definition</strong> of a static data member that is odr-used (3.2) in a program; <strong>no diagnostic is required.</strong>\n  \u2014end note ]</p></li>\n</ol>\n</blockquote>\n", "OwnerUserId": "2805305", "PostTypeId": "2", "Id": "45719751", "Score": "1", "CreationDate": "2017-08-16T17:31:57.290", "LastActivityDate": "2017-08-16T17:31:57.290"}, "45719501": {"ParentId": "45719407", "PostTypeId": "2", "CommentCount": "3", "Body": "<p>As a rule, all static const names should be defined in .cpp file if they are <a href=\"https://stackoverflow.com/questions/23491781/when-is-a-variable-odr-used-in-c14\">ODR used</a>. Taking a reference to the argument is <code>ODR using</code> them. However, having violated this rule is undefined behavior, and MSVC not reporting an error is just one of the ways undefined behavior can be manifested.</p>\n<p>As a practical consideration, you are likely to have the error when function is not inlined, and probably won't see it for the inlined functions. My guess is that inlining works differently with the level of optimization you are using for those compilers.</p>\n", "OwnerUserId": "5245033", "LastEditorUserId": "5245033", "LastEditDate": "2017-08-16T17:24:50.943", "Id": "45719501", "Score": "1", "CreationDate": "2017-08-16T17:15:23.380", "LastActivityDate": "2017-08-16T17:24:50.943"}, "bq_ids": {"n4140": {"so_45719407_45719751_2": {"section_id": 5909, "quality": 0.7692307692307693, "length": 10}, "so_45719407_45719751_1": {"section_id": 5908, "quality": 0.9629629629629629, "length": 26}}, "n3337": {"so_45719407_45719751_2": {"section_id": 5681, "quality": 0.7692307692307693, "length": 10}, "so_45719407_45719751_1": {"section_id": 5680, "quality": 0.9629629629629629, "length": 26}}, "n4659": {"so_45719407_45719751_2": {"section_id": 7391, "quality": 0.7692307692307693, "length": 10}, "so_45719407_45719751_1": {"section_id": 7390, "quality": 0.9629629629629629, "length": 26}}}, "45719407": {"CommentCount": "5", "ViewCount": "88", "PostTypeId": "1", "LastEditorUserId": "5245033", "CreationDate": "2017-08-16T17:10:55.113", "LastActivityDate": "2017-08-16T17:31:57.290", "Title": "Undefined reference to static const integral type", "AcceptedAnswerId": "45719501", "LastEditDate": "2017-08-16T17:26:32.577", "Id": "45719407", "Score": "3", "Body": "<p>I have a weird behaviour with static integal constants:</p>\n<pre><code>#include &lt;iostream&gt;\n#include &lt;inttypes.h&gt;\n\nclass Test{\npublic:\n static const uint32_t Magic = 0x1123;\n};\n\nclass DataStream{\npublic:\n    template&lt;typename T&gt;\n    DataStream&amp; operator &lt;&lt;( const T&amp; value )\n    {\n        std::cout &lt;&lt; value &lt;&lt; std::endl;\n        return *this;\n    }\n};\n\nint main()\n{\n    DataStream s;\n\n    uint32_t a = Test::Magic;  // ok\n    bool compare = ( a == Test::Magic ); // ok\n    s &lt;&lt; compare;\n    s &lt;&lt; a;\n    s &lt;&lt; Test::Magic;  // fail\n\n    return 0;\n}\n</code></pre>\n<p>I know that such constants should be defined outside of class in .cpp as</p>\n<pre><code>const uint32_t Test::Magic;\n</code></pre>\n<p>But strange things is that code above work fine with out line <code>s &lt;&lt; Test::Magic;</code> and produce error only if <code>Magic</code> used with template <code>operator &lt;&lt;</code> directly.</p>\n<p>Even more error <code>undefined reference to 'Test::Magic'</code> appear with <code>GCC</code>, but not with <code>MSVC</code>.</p>\n<p>The question is why I should define <code>Test::Magic</code> outside of class (even without value!!!), and why my code work fine in some conditions even without such definition?</p>\n", "Tags": "<c++>", "OwnerUserId": "1213270", "AnswerCount": "2"}});