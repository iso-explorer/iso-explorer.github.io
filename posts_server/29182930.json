post_cb({"bq_ids": {"n4140": {"so_29182930_29184815_1": {"length": 12, "quality": 0.8571428571428571, "section_id": 4503}}, "n3337": {"so_29182930_29184815_1": {"length": 12, "quality": 0.8571428571428571, "section_id": 4334}}}, "29184815": {"PostTypeId": "2", "Body": "<p>Firstly, clang 3.5.0 (not Apple's) compiles your example, so there seems to be a problem with your specific version or installation of clang.</p>\n<p>Secondly, I believe your example is well formed and well defined, because the standard does not specify the exact type parameter of the owning <code>shared_ptr</code> instance (<code>p</code> in your example):</p>\n<blockquote>\n<p id=\"so_29182930_29184815_0\">[util.smartptr.enab]/7</p>\n<pre><code>shared_ptr&lt;T&gt; shared_from_this();\nshared_ptr&lt;T const&gt; shared_from_this() const;\n</code></pre>\n<p id=\"so_29182930_29184815_1\"><em>Requires:</em> <code>enable_shared_from_this&lt;T&gt;</code> shall be an accessible base class of <code>T</code>. <code>*this</code> shall be a subobject of an object <code>t</code> of type <code>T</code>. <strong>There shall be at least one <code>shared_ptr</code> instance <code>p</code> that owns <code>&amp;t</code>.</strong></p>\n</blockquote>\n", "LastActivityDate": "2015-03-21T16:03:51.290", "Id": "29184815", "CommentCount": "0", "CreationDate": "2015-03-21T16:03:51.290", "ParentId": "29182930", "Score": "1", "OwnerUserId": "1639256"}, "29182930": {"ViewCount": "801", "Body": "<p>Consider this piece of code</p>\n<pre><code>#include &lt;memory&gt;\n\nclass FooBar :  public std::enable_shared_from_this&lt;FooBar&gt;{};\ntypedef std::shared_ptr&lt;const FooBar&gt; ConstantPointer;\n\nint main()\n{\n  ConstantPointer  p(new FooBar());\n  return 0;\n}\n</code></pre>\n<p>On g++ version 4.7.4 it compiles without problems when using <strong>-std=c++11</strong> option</p>\n<p>On clang++ version \n<strong>Apple LLVM version 6.0 (clang-600.0.57) (based on LLVM 3.5svn)</strong></p>\n<p>it generates the following compile error</p>\n<pre><code>In file included from main.cpp:1:\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:4013:35: error: no viable overloaded '='\n                __e-&gt;__weak_this_ = *this;\n                ~~~~~~~~~~~~~~~~~ ^ ~~~~~\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:4050:5: note: in instantiation of function template specialization\n      'std::__1::shared_ptr&lt;const FooBar&gt;::__enable_weak_this&lt;FooBar&gt;' requested here\n    __enable_weak_this(__p);\n    ^\nmain.cpp:8:20: note: in instantiation of function template specialization 'std::__1::shared_ptr&lt;const FooBar&gt;::shared_ptr&lt;FooBar, void&gt;' requested here\n  ConstantPointer  p(new FooBar());\n                   ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:4942:15: note: candidate function not viable: no known conversion from\n      'std::__1::shared_ptr&lt;const FooBar&gt;' to 'const std::__1::weak_ptr&lt;FooBar&gt;' for 1st argument\n    weak_ptr&amp; operator=(weak_ptr const&amp; __r) _NOEXCEPT;\n              ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:4949:9: note: candidate template ignored: could not match 'weak_ptr' against 'shared_ptr'\n        operator=(weak_ptr&lt;_Yp&gt; const&amp; __r) _NOEXCEPT;\n        ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:4967:13: note: candidate template ignored: disabled by 'enable_if' [with _Yp = const FooBar]\n            is_convertible&lt;_Yp*, element_type*&gt;::value,\n</code></pre>\n<p>My question is if it is compiler bug or non confirming code ?</p>\n", "Title": "Compile errors while using shared_ptr with enable_shared_from_this on clang++", "CreationDate": "2015-03-21T12:52:10.117", "LastActivityDate": "2015-03-21T16:03:51.290", "CommentCount": "2", "PostTypeId": "1", "Id": "29182930", "Score": "1", "OwnerUserId": "764882", "Tags": "<c++><c++11><clang++>", "AnswerCount": "1"}});