post_cb({"40174207": {"CommentCount": "5", "CreationDate": "2016-10-21T10:26:27.037", "PostTypeId": "1", "AcceptedAnswerId": "40175849", "LastEditorUserId": "5489178", "LastActivityDate": "2016-10-22T21:01:24.727", "LastEditDate": "2016-10-21T10:46:32.820", "ViewCount": "365", "FavoriteCount": "1", "Title": "Why cannot I delete unique_ptr<char[]> with reset()?", "Id": "40174207", "Score": "5", "Body": "<p>When I have an unique pointer to a single object, I can delete it with <code>reset()</code>:</p>\n<pre><code>std::unique_ptr&lt;char&gt; variable(new char);\nvariable.reset();\n</code></pre>\n<p>However, this does not work for an <code>std::unique_ptr</code> containing an array. Why? What is the proper way to delete such pointer?</p>\n<p>I am using Embarcadero C++ Builder 10.1. and the relevant standard is C++11.</p>\n<h2>My observations</h2>\n<p>When I have an unique pointer containing an array, this fails to compile:</p>\n<pre><code>std::unique_ptr&lt;char[]&gt; variable(new char[10]);\nvariable.reset();\n</code></pre>\n<p>Error message is <code>no matching function to call for 'reset'</code>.</p>\n<p>This also fails:</p>\n<pre><code>std::unique_ptr&lt;char[]&gt; variable(new char[10]);\nvariable.reset(nullptr);\n</code></pre>\n<p>Error messages are <code>cannot initialize a variable of type 'pointer' (aka 'char *') with an lvalue of type '&lt;bound member function type&gt;'</code> and <code>assigning to '&lt;bound member function type&gt;' from incompatible type '_Null_ptr_type' (aka 'nullptr_t')</code>.</p>\n<p>This compiles:</p>\n<pre><code>std::unique_ptr&lt;char[]&gt; variable(new char[10]);\nvariable = nullptr;\n</code></pre>\n<h2>Relevant code from &lt;memory&gt;</h2>\n<pre><code>template&lt;class _Uty&gt;\nusing _Enable_ctor_reset = enable_if_t&lt;\n    is_same&lt;_Uty, pointer&gt;::value\n    || (is_same&lt;pointer, element_type *&gt;::value\n    &amp;&amp; is_pointer&lt;_Uty&gt;::value\n    &amp;&amp; is_convertible&lt;\n        remove_pointer_t&lt;_Uty&gt;(*)[],\n        element_type(*)[]\n    &gt;::value)&gt;;\n\n_Myt&amp; operator=(_Null_ptr_type) _NOEXCEPT\n    {   // assign a null pointer\n    reset(pointer());\n    return (*this);\n    }\n\n_NOINLINE void reset(_Null_ptr_type _Ptr) _NOEXCEPT\n    {   // establish new null pointer\n    pointer _Old = this-&gt;_Myptr;\n    this-&gt;_Myptr = _Ptr;\n    if (_Old != pointer())\n        this-&gt;get_deleter()(_Old);\n    }\n\ntemplate&lt;class _Uty,\n    class = _Enable_ctor_reset&lt;_Uty&gt; &gt;\nvoid reset(_Uty _Ptr) _NOEXCEPT\n    {   // establish new pointer\n    pointer _Old = get();\n    this-&gt;_Myptr() = _Ptr;\n    if (_Old != pointer())\n        this-&gt;get_deleter()(_Old);\n    }\n</code></pre>\n", "Tags": "<c++><c++11><c++builder><unique-ptr>", "OwnerUserId": "5489178", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_40174207_40175849_0": {"section_id": 4339, "quality": 1.0, "length": 4}}, "n3337": {"so_40174207_40175849_0": {"section_id": 4180, "quality": 1.0, "length": 4}}, "n4659": {"so_40174207_40175849_0": {"section_id": 5596, "quality": 1.0, "length": 4}}}, "40175849": {"ParentId": "40174207", "PostTypeId": "2", "CommentCount": "0", "Body": "<p>It seems that this is a bug in the standard library, because the same code compiles with other compilers, as pointed out by <a href=\"https://stackoverflow.com/users/3065406/dew1\">deW1</a> and <a href=\"https://stackoverflow.com/users/1057286/sanjay\">sanjay</a> in comments.</p>\n<p>C++11 standard, section 20.7.1.3 (<em>\"unique_ptr for array objects with a runtime length\"</em>) lists <code>reset()</code> with the following signature:</p>\n<blockquote>\n<p id=\"so_40174207_40175849_0\">void reset(pointer p = pointer()) noexcept;</p>\n</blockquote>\n<p>The first example fails to compile, because the default argument is missing from the standard library implementation. The second example essentially calls <code>reset(pointer())</code>, which fails to compile. Possibly this compile error is the reason why the default argument has not been added.</p>\n<p>I have made a bug report to Embarcadero:</p>\n<p><a href=\"https://quality.embarcadero.com/browse/RSP-16165\" rel=\"nofollow noreferrer\">RSP-16165 Compile error when calling reset() on unique_ptr containing array object</a></p>\n", "OwnerUserId": "5489178", "LastEditorUserId": "-1", "LastEditDate": "2017-05-23T12:01:21.170", "Id": "40175849", "Score": "1", "CreationDate": "2016-10-21T11:44:05.557", "LastActivityDate": "2016-10-22T21:01:24.727"}});