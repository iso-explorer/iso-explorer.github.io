post_cb({"39353937": {"ParentId": "39353607", "CommentCount": "1", "Body": "<p>That exception was removed from <code>std::mutex</code> by <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html#2309\" rel=\"nofollow\">Library Issue #2309</a>, so perhaps g++ 5.4 is just up-to-date.</p>\n", "OwnerUserId": "597607", "PostTypeId": "2", "Id": "39353937", "Score": "0", "CreationDate": "2016-09-06T16:38:41.790", "LastActivityDate": "2016-09-06T16:38:41.790"}, "39353674": {"ParentId": "39353607", "CommentCount": "12", "Body": "<p>Your code has undefined behaviour, because you are violating a precondition ([thread.mutex.requirements.mutex]):</p>\n<blockquote>\n<p id=\"so_39353607_39353674_0\">The expression <code>m.lock()</code> shall be well-formed and have the following semantics:</p>\n<p id=\"so_39353607_39353674_1\"><em>Requires:</em> If <code>m</code> is of type <code>std::mutex</code> [...], the calling thread does not own the mutex.</p>\n</blockquote>\n", "OwnerUserId": "596781", "PostTypeId": "2", "Id": "39353674", "Score": "5", "CreationDate": "2016-09-06T16:23:16.390", "LastActivityDate": "2016-09-06T16:23:16.390"}, "39353607": {"CommentCount": "3", "ViewCount": "88", "PostTypeId": "1", "LastEditorUserId": "1608835", "CreationDate": "2016-09-06T16:19:44.693", "LastActivityDate": "2016-09-06T16:38:41.790", "Title": "Recursive lock() call in g++", "AcceptedAnswerId": "39353674", "LastEditDate": "2016-09-06T16:22:54.780", "Id": "39353607", "Score": "2", "Body": "<p>Why does the following code result in a deadlock in g++ 5.4.0?</p>\n<pre><code>#include &lt;mutex&gt;\n\nint main()\n{\n    std::mutex m;\n    m.lock();\n    m.lock();\n}\n</code></pre>\n<p>As far as I know, this code should result in an exception according to the Standard:</p>\n<blockquote>\n<p id=\"so_39353607_39353607_0\">30.4.1.2 Mutex types [thread.mutex.requirements.mutex]</p>\n<p id=\"so_39353607_39353607_1\">6 The expression m.lock() shall be well-formed and have the following\n  semantics:</p>\n<p id=\"so_39353607_39353607_2\">[...]</p>\n<p id=\"so_39353607_39353607_3\">12 Throws: system_error when an exception is required (30.2.2).</p>\n<p id=\"so_39353607_39353607_4\">13 Error conditions:</p>\n<p id=\"so_39353607_39353607_5\">(13.1) \u2014 operation_not_permitted \u2014 if the thread does not have the\n  privilege to perform the operation.</p>\n<p id=\"so_39353607_39353607_6\">(13.2) \u2014 resource_deadlock_would_occur \u2014 if the implementation detects\n  that a deadlock would occur.</p>\n<p id=\"so_39353607_39353607_7\">(13.3) \u2014 <strong>device_or_resource_busy \u2014 if the mutex is already locked and\n  blocking is not possible</strong>.</p>\n</blockquote>\n<p>What's wrong then? Is it a bug in the library?</p>\n", "Tags": "<c++><multithreading><c++11><gcc><c++14>", "OwnerUserId": "1608835", "AnswerCount": "2"}, "bq_ids": {"n4140": {"so_39353607_39353607_5": {"section_id": 2751, "quality": 0.875, "length": 7}, "so_39353607_39353607_6": {"section_id": 2760, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353607_3": {"section_id": 2727, "quality": 0.6666666666666666, "length": 4}, "so_39353607_39353607_1": {"section_id": 2753, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353674_1": {"section_id": 2754, "quality": 0.875, "length": 7}, "so_39353607_39353674_0": {"section_id": 2753, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353607_7": {"section_id": 2760, "quality": 0.8571428571428571, "length": 6}}, "n3337": {"so_39353607_39353607_5": {"section_id": 2712, "quality": 0.875, "length": 7}, "so_39353607_39353607_6": {"section_id": 2721, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353607_3": {"section_id": 2688, "quality": 0.6666666666666666, "length": 4}, "so_39353607_39353607_1": {"section_id": 2714, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353674_1": {"section_id": 2715, "quality": 0.875, "length": 7}, "so_39353607_39353674_0": {"section_id": 2714, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353607_7": {"section_id": 2721, "quality": 0.8571428571428571, "length": 6}}, "n4659": {"so_39353607_39353607_5": {"section_id": 3489, "quality": 0.875, "length": 7}, "so_39353607_39353607_6": {"section_id": 3498, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353607_3": {"section_id": 3466, "quality": 0.6666666666666666, "length": 4}, "so_39353607_39353674_1": {"section_id": 3492, "quality": 0.75, "length": 6}, "so_39353607_39353607_1": {"section_id": 3491, "quality": 0.8571428571428571, "length": 6}, "so_39353607_39353674_0": {"section_id": 3491, "quality": 0.8571428571428571, "length": 6}}}});