post_cb({"26062865": {"CommentCount": "2", "ViewCount": "514", "CreationDate": "2014-09-26T15:16:21.150", "LastActivityDate": "2014-09-27T11:58:39.463", "Title": "use POST to send a file using c++", "AcceptedAnswerId": "26064070", "PostTypeId": "1", "Id": "26062865", "Score": "0", "Body": "<pre><code>#include &lt;winsock2.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#pragma comment(lib,\"ws2_32.lib\")\nusing namespace std;\nint main (){\n    WSADATA wsaData;\n    if (WSAStartup(MAKEWORD(2,2), &amp;wsaData) != 0) {\n        cout &lt;&lt; \"WSAStartup failed.\\n\";\n        system(\"pause\");\n        return 1;\n    }\n    SOCKET Socket=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);\n    struct hostent *host;\n    host = gethostbyname(\"127.0.0.1\");\n    SOCKADDR_IN SockAddr;\n    SockAddr.sin_port=htons(80);\n    SockAddr.sin_family=AF_INET;\n    SockAddr.sin_addr.s_addr = *((unsigned long*)host-&gt;h_addr);\n    cout &lt;&lt; \"Connecting...\\n\";\n    if(connect(Socket,(SOCKADDR*)(&amp;SockAddr),sizeof(SockAddr)) != 0){\n        cout &lt;&lt; \"Could not connect\";\n        system(\"pause\");\n        return 1;\n    }\n    cout &lt;&lt; \"Connected.\\n\";\n\n\n    char header[]=\"POST /xampp/tests/file/upload_file.php HTTP/1.1\\r\\nHost: 127.0.0.1 \\r\\n Content-Disposition: form-data\\r\\n uname=sase \\r\\n  Connection: close\\r\\n\\r\\n \";\n\n    send(Socket,header, strlen(header),0);\n    char buffer[100000];\n    int nDataLength;\n    while ((nDataLength = recv(Socket,buffer,100000,0)) &gt; 0){        \n        int i = 0;\n        while (buffer[i] &gt;= 32 || buffer[i] == '\\n' || buffer[i] == '\\r') {\n            cout &lt;&lt; buffer[i];\n            i += 1;\n        }\n    }\n    closesocket(Socket);\n        WSACleanup();\n    system(\"pause\");\n    return 0;\n}\n</code></pre>\n<p>i have this code from the internet, how do i make it send a file using the POST method. <br> I was at this for more than 5 hours. Please help. Also is there another way of sending http-headers/uploading a with c++ without using other libraries.</br></p>\n", "Tags": "<c++><post><http-headers><winsock><winsock2>", "OwnerUserId": "3483665", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_26062865_26064070_1": {"section_id": 3314, "quality": 0.6818181818181818, "length": 15}, "so_26062865_26064070_0": {"section_id": 5345, "quality": 1.0, "length": 5}}, "n3337": {"so_26062865_26064070_1": {"section_id": 3184, "quality": 0.7272727272727273, "length": 16}, "so_26062865_26064070_0": {"section_id": 5142, "quality": 1.0, "length": 5}}, "n4659": {"so_26062865_26064070_1": {"section_id": 4080, "quality": 0.6818181818181818, "length": 15}, "so_26062865_26064070_0": {"section_id": 6770, "quality": 1.0, "length": 5}}}, "26064070": {"ParentId": "26062865", "PostTypeId": "2", "CommentCount": "4", "Body": "<p>In the HTTP protocol, the data for the form goes in the body, not in the header. The header is separated from the body by a blank line (<code>\\r\\n\\r\\n</code>). In your code, you're trying to send the data in the header, which is incorrect. You also are using the <code>Content-Disposition</code> header. In fact, you don't need it. You need the <code>Content-Type</code> and <code>Content-Length</code> headers.</p>\n<pre><code>char header[]=\"POST /xampp/tests/file/upload_file.php HTTP/1.1\\r\\n\"\n              \"Host: 127.0.0.1\\r\\n\"\n              \"Content-Type: application/x-www-form-urlencoded\\r\\n\"\n              \"Content-Length: 10\\r\\n\"\n              \"Connection: close\\r\\n\"\n              \"\\r\\n\"\n              \"uname=sase\";\n</code></pre>\n<hr>\n<p>There seems to be some confusion about the <code>\\n</code> escape sequence. The C++ standard defines <code>\\n</code> to be a single LF character in 2.14.3 and says of all escape sequences:</p>\n<blockquote>\n<p id=\"so_26062865_26064070_0\">An escape sequence specifies a single character.</p>\n</blockquote>\n<p>8.5.2 confirms this with an example:</p>\n<blockquote>\n<p id=\"so_26062865_26064070_1\"><code>char msg[] = \"Syntax error on line %s\\n\";</code> shows a character array\n  whose members are initialized with a string-literal . Note that\n  because <strong>\u2019\\n\u2019 is a single character</strong> and because a trailing \u2019\\0\u2019 is\n  appended, sizeof(msg) is 25 . \u2014end example ]</p>\n</blockquote>\n</hr>", "OwnerUserId": "2101267", "LastEditorUserId": "2101267", "LastEditDate": "2014-09-27T11:58:39.463", "Id": "26064070", "Score": "1", "CreationDate": "2014-09-26T16:22:54.280", "LastActivityDate": "2014-09-27T11:58:39.463"}});