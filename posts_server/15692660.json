post_cb({"15692660": {"CommentCount": "0", "ViewCount": "138", "PostTypeId": "1", "LastEditorUserId": "2008149", "CreationDate": "2013-03-28T21:39:12.457", "LastActivityDate": "2013-04-04T01:24:10.107", "Title": "Is it legal to friend a function via a using declaration?", "AcceptedAnswerId": "15692739", "LastEditDate": "2013-04-04T01:24:10.107", "Id": "15692660", "Score": "5", "Body": "<p>The following <a href=\"http://liveworkspace.org/code/2NVszT\" rel=\"nofollow\">(LiveWorkspace here)</a> is rejected by GCC 4.7.2, GCC 4.8.0, and ICC 13.0.1.</p>\n<pre><code>namespace A {\n    namespace B {\n        void C();\n    }\n    using B::C;\n}\n\nclass D {\n    friend void A::C();\n};\n</code></pre>\n<p>Additionally, it crashes Clang 3.2 (!). I've submitted a bug report and <a href=\"http://lists.cs.uiuc.edu/pipermail/cfe-commits/Week-of-Mon-20130318/076411.html\" rel=\"nofollow\">patch</a> already, for the crash bug, but I'm not 100% sure if this code is really in error, because I can't find anything in <strong>\u00a77.3.3 [namespace.udecl]</strong> or <strong>\u00a711.3 [class.friend]</strong> that explicitly addresses this case, but maybe there's something in the definition of one of the various name specifier terms that I've missed.</p>\n<p>Furthermore, it seems like all four compilers accept the following <a href=\"http://liveworkspace.org/code/2rWG6L\" rel=\"nofollow\">(LiveWorkspace here)</a>:</p>\n<pre><code>namespace A {\n    namespace B {\n        class C;\n    }\n    using B::C;\n}\n\nclass D {\n    friend class A::C;\n};\n</code></pre>\n<p>There doesn't seem to be anything fundamentally different about these two cases, so I'm curious what GCC and ICC's grounds to reject the first example but not this one are, if any. Can anyone more familiar with the standard find anything that addresses this?</p>\n<p>It's definitely a minor issue at best, but since I'm patching it, I'd like to be sure I'm doing the right thing...</p>\n<p><strong>EDIT</strong>: <a href=\"http://lists.cs.uiuc.edu/pipermail/cfe-commits/Week-of-Mon-20130401/077351.html\" rel=\"nofollow\">This is patched now in clang/trunk!</a></p>\n<p><strong>NEW EDIT</strong>: Johannes's answer below explains why my original example is rejected, but it doesn't seem to explain why GCC and ICC also reject the following <a href=\"http://liveworkspace.org/code/OZOR5\" rel=\"nofollow\">(LiveWorkspace here)</a>:</p>\n<pre><code>namespace A {\n    namespace B {\n        void C();\n    }\n    using B::C;\n\n    class D {\n        friend void C();\n    };\n}\n</code></pre>\n", "Tags": "<c++><language-lawyer>", "OwnerUserId": "2008149", "AnswerCount": "1"}, "15692739": {"ParentId": "15692660", "CommentCount": "5", "Body": "<p>8.3p1:</p>\n<blockquote>\n<p id=\"so_15692660_15692739_0\">When the declarator-id is qualified,\n  the declaration shall refer to a previously declared member of the class or namespace to which the qualifier\n  refers (or, in the case of a namespace, of an element of the inline namespace set of that namespace (7.3.1))\n  or to a specialization thereof; <strong>the member shall not merely have been introduced by a using-declaration\n  in the scope of the class or namespace nominated by the nested-name-specifier of the declarator-id.</strong></p>\n</blockquote>\n<p>A <code>class foo;</code> or <code>class foo::bar;</code> does not contain a declarator-id, so it is not affected by this rule. Instead, the <code>foo::bar</code> is part of an elaborated-type-specifier (7.1.6.3).</p>\n", "OwnerUserId": "34509", "PostTypeId": "2", "Id": "15692739", "Score": "4", "CreationDate": "2013-03-28T21:45:57.957", "LastActivityDate": "2013-03-28T21:45:57.957"}, "bq_ids": {"n4140": {"so_15692660_15692739_0": {"section_id": 3208, "quality": 0.9705882352941176, "length": 33}}, "n3337": {"so_15692660_15692739_0": {"section_id": 3082, "quality": 0.9705882352941176, "length": 33}}, "n4659": {"so_15692660_15692739_0": {"section_id": 3965, "quality": 0.9705882352941176, "length": 33}}}});