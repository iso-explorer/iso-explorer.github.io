post_cb({"31007045": {"ParentId": "31006916", "PostTypeId": "2", "CommentCount": "2", "Body": "<p>Making <code>A</code> a <strong>virtual</strong> base class of <code>B</code> and <code>C</code> ensures that <code>D</code> contains exactly one <code>A</code> subobject<sup>[1]</sup>. For this, both <code>B</code> and <code>C</code> provide final overriders for <code>foo</code><sup>[2]</sup> and both are inherited by <code>D</code><sup>[2]</sup>, so <code>D</code> has two final overriders for <code>foo</code>, making the program ill-formed<sup>[2]</sup>.</p>\n<p>When <code>A</code> is <strong>not</strong> a virtual base class of <code>B</code> and <code>C</code>, <code>D</code> will contain two distinct <code>A</code> subobjects<sup>[1]</sup>. Each of these subobjects will have their own inherited final overrider for <code>foo</code><sup>[2]</sup>.</p>\n<hr>\n<p>[1]: N4140 \u00a710.1 [class.mi]/4:</p>\n<blockquote>\n<p id=\"so_31006916_31007045_0\">A base class specifier that does not contain the keyword virtual, specifies a non-virtual base class. A base class specifier that contains the keyword virtual, specifies a virtual base class. For each distinct occurrence\n  of a non-virtual base class in the class lattice of the most derived class, the most derived object shall contain a corresponding distinct base class subobject of that type. For each distinct base class that is specified virtual, the most derived object shall contain a single base class subobject of that type.</p>\n</blockquote>\n<p>[2]: \u00a710.3 [class.virtual]/2 (emphasis mine):</p>\n<blockquote>\n<p id=\"so_31006916_31007045_1\">If a virtual member function vf is declared in a class Base and in a class Derived, derived directly or indirectly from Base, a member function vf with the same name, parameter-type-list, cv-qualification, and ref-qualifier (or absence of same) as Base::vf is declared, then <strong>Derived::vf is also virtual (whether or not it is so declared) and it overrides Base::vf.</strong> For convenience we say that any virtual function overrides itself. <strong>A virtual member function C::vf of a class object S is a final overrider unless the most derived class of which S is a base class subobject (if any) declares or inherits another member function that overrides vf. In a derived class, if a virtual member function of a base class subobject has more than one final overrider the program is ill-formed.</strong></p>\n</blockquote>\n</hr>", "OwnerUserId": "962089", "LastEditorUserId": "962089", "LastEditDate": "2015-06-23T15:41:15.550", "Id": "31007045", "Score": "4", "CreationDate": "2015-06-23T15:27:42.623", "LastActivityDate": "2015-06-23T15:41:15.550"}, "31006916": {"CommentCount": "5", "ViewCount": "199", "PostTypeId": "1", "LastEditorUserId": "4645236", "CreationDate": "2015-06-23T15:22:04.910", "LastActivityDate": "2015-06-23T17:16:40.177", "Title": "C++ Virtual Inheritance of virtual method", "AcceptedAnswerId": "31007045", "LastEditDate": "2015-06-23T17:16:40.177", "Id": "31006916", "Score": "4", "Body": "<pre><code>struct A {\n    virtual void foo() { std::cout &lt;&lt; \"a\";};\n};\n\nstruct B:public virtual A {\n    void foo() { std::cout &lt;&lt; \"b\";}\n};\n\nstruct C:public virtual A {\n    void foo() { std::cout &lt;&lt; \"c\";}\n};\n\nstruct D:public B, public C {\n\n};\nint main() {\n    return 0;\n}\n</code></pre>\n<p>So this one while compiling gives us the following error:</p>\n<pre><code> \\main.cpp:16:8: error: no unique final overrider for 'virtual void A::foo()' in 'D'\n struct D:public B, public C {\n</code></pre>\n<p>If we would make the inheritance of B and C structs non-virtual, the code <strong>is compiling</strong> just right without any errors (but of course the error happens if we're calling dd.foo()). So what's the difference? Why do we have an error when we inherit our class virtually and no error if we do it straight?</p>\n", "Tags": "<c++><inheritance><virtual><virtual-inheritance>", "OwnerUserId": "5040980", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_31006916_31007045_0": {"section_id": 6985, "quality": 0.9491525423728814, "length": 56}, "so_31006916_31007045_1": {"section_id": 7003, "quality": 0.9583333333333334, "length": 69}}, "n3337": {"so_31006916_31007045_0": {"section_id": 6731, "quality": 0.9491525423728814, "length": 56}, "so_31006916_31007045_1": {"section_id": 6749, "quality": 0.9583333333333334, "length": 69}}, "n4659": {"so_31006916_31007045_0": {"section_id": 8483, "quality": 0.8983050847457628, "length": 53}, "so_31006916_31007045_1": {"section_id": 8500, "quality": 0.9583333333333334, "length": 69}}}});