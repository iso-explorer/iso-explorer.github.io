post_cb({"7214623": {"CommentCount": "3", "AcceptedAnswerId": "7215486", "PostTypeId": "1", "LastEditorUserId": "500104", "CreationDate": "2011-08-27T12:42:13.687", "LastActivityDate": "2012-05-29T15:03:16.463", "LastEditDate": "2012-05-29T15:03:16.463", "ViewCount": "6358", "FavoriteCount": "4", "Title": "Rule for lambda capture variable", "Id": "7214623", "Score": "7", "Body": "<p>For example:</p>\n<pre><code>class Example\n{\npublic:\n    explicit Example(int n) : num(n) {}\n    void addAndPrint(vector&lt;int&gt;&amp; v) const\n    {\n        for_each(v.begin(), v.end(), [num](int n) { cout &lt;&lt; num + n &lt;&lt; \" \"; });\n    }\nprivate:\n    int num;\n};\n\nint main()\n{\n    vector&lt;int&gt; v = { 0, 1, 2, 3, 4 };\n\n    Example ex(1);\n    ex.addAndPrint(v);\n    return 0;\n}\n</code></pre>\n<p>When you compile and run this in MSVC2010 you get the following error:</p>\n<p><strong>error C3480: 'Example::num': a lambda capture variable must be from an enclosing function scope</strong></p>\n<p>However, with g++ 4.6.2 (prerelease) you get:</p>\n<p><strong>1 2 3 4 5</strong></p>\n<p>Which compiler is right according to the standard draft?</p>\n", "Tags": "<c++><visual-c++><lambda><c++11><g++>", "OwnerUserId": "906773", "AnswerCount": "2"}, "7214780": {"ParentId": "7214623", "CommentCount": "1", "Body": "<p>Standard says the following (5.1.2):</p>\n<p>The identifiers in a capture-list are looked up using the usual rules for unqualified name lookup (3.4.1); each\n   such lookup shall find a variable with automatic storage duration declared in the reaching scope of the local\n    lambda expression.</p>\n<p>To my understanding GCC compiler is right because 'num' is in the reaching scope at the point of lambda declaration.</p>\n", "OwnerUserId": "861232", "PostTypeId": "2", "Id": "7214780", "Score": "0", "CreationDate": "2011-08-27T13:14:24.507", "LastActivityDate": "2011-08-27T13:14:24.507"}, "7215486": {"ParentId": "7214623", "CommentCount": "1", "Body": "<p>5.1.2/9:</p>\n<blockquote>\n<p id=\"so_7214623_7215486_0\">The reaching scope of a local lambda expression is the set of\n  enclosing scopes up to and including the innermost enclosing function\n  and its parameters.</p>\n</blockquote>\n<p>and 5.1.2/10:</p>\n<blockquote>\n<p id=\"so_7214623_7215486_1\">The identifiers in a capture-list are looked up using the usual rules\n  for unqualified name lookup (3.4.1); each such lookup shall find a\n  variable with automatic storage duration declared in the reaching\n  scope of the local lambda expression.</p>\n</blockquote>\n<p>As <code>num</code> is neither declared in any function scope nor has automatic storage duration, it cannot be captured. Thus VS is right and g++ is wrong.</p>\n", "OwnerUserId": "775806", "PostTypeId": "2", "Id": "7215486", "Score": "7", "CreationDate": "2011-08-27T15:28:28.387", "LastActivityDate": "2011-08-27T15:28:28.387"}, "bq_ids": {"n4140": {"so_7214623_7215486_1": {"section_id": 5969, "quality": 0.84, "length": 21}, "so_7214623_7215486_0": {"section_id": 5968, "quality": 0.8666666666666667, "length": 13}}, "n3337": {"so_7214623_7215486_1": {"section_id": 5738, "quality": 0.92, "length": 23}, "so_7214623_7215486_0": {"section_id": 5737, "quality": 0.8666666666666667, "length": 13}}, "n4659": {"so_7214623_7215486_1": {"section_id": 7467, "quality": 0.84, "length": 21}, "so_7214623_7215486_0": {"section_id": 7466, "quality": 0.8666666666666667, "length": 13}}}});