post_cb({"1135822": {"CommentCount": "1", "AcceptedAnswerId": "1135834", "PostTypeId": "1", "LastEditorUserId": "277176", "CreationDate": "2009-07-16T06:49:25.937", "LastActivityDate": "2017-01-01T19:40:29.580", "LastEditDate": "2017-01-01T19:40:29.580", "ViewCount": "27880", "FavoriteCount": "5", "Title": "Escaping a # symbol in a #define macro?", "Id": "1135822", "Score": "33", "Body": "<p>Without going into the gory details I want to use a <code>#define</code> macro that will expand to a <code>#include</code> but the '#' sign is confusing the preprocessor (as it thinks I want to quote an argument.)</p>\n<p>For example, I want to do something like this:</p>\n<pre><code>#define MACRO(name) #include \"name##foo\"\n</code></pre>\n<p>And use it thus:</p>\n<pre><code>MACRO(Test)\n</code></pre>\n<p>Which will expand to:</p>\n<pre><code>#include \"Testfoo\"\n</code></pre>\n<p>The humble # sign is causing the preprocessor to barf.  MinGW gives me the following error:</p>\n<p><code>'#' is not followed by a macro parameter</code></p>\n<p>I guess I need to escape the # sign but I don't if this is even possible.</p>\n<p>Yes, macros are indeed evil...</p>\n", "Tags": "<c++><c><macros><c-preprocessor><preprocessor-directive>", "OwnerUserId": "9236", "AnswerCount": "8"}, "8289287": {"ParentId": "1135822", "CommentCount": "0", "Body": "<p>It <em>is</em> possible to insert a hash token into the preprocessed token stream. You can do it as follows:</p>\n<pre><code>#define MACRO(hash, name) hash include name\nMACRO(#,\"hello\")\n</code></pre>\n<p>\u2014expands to:</p>\n<pre><code># include \"hello\"\n</code></pre>\n<p><em>However</em>, the standard explicitly rules out any further analysis of such line for the existence of preprocessing directives [cpp.rescan]:</p>\n<blockquote>\n<p id=\"so_1135822_8289287_0\">The resulting completely macro-replaced preprocessing token sequence is not processed as a preprocessing directive even if it resembles one.</p>\n</blockquote>\n", "OwnerUserId": "277176", "PostTypeId": "2", "Id": "8289287", "Score": "28", "CreationDate": "2011-11-27T21:39:31.587", "LastActivityDate": "2011-11-27T21:39:31.587"}, "1135831": {"ParentId": "1135822", "PostTypeId": "2", "CommentCount": "2", "Body": "<p>This <em>might</em> work (it works for regular <code>#define</code> macros with no parameters, but I haven't tested it with macros with parameters).</p>\n<pre><code>#define MACRO(name) &lt;name##foo&gt;\n#include MACRO(Test)\n</code></pre>\n", "OwnerUserId": "138304", "LastEditorUserId": "138304", "LastEditDate": "2009-07-16T07:05:16.700", "Id": "1135831", "Score": "2", "CreationDate": "2009-07-16T06:52:42.047", "LastActivityDate": "2009-07-16T07:05:16.700"}, "39616615": {"ParentId": "1135822", "CommentCount": "1", "Body": "<pre><code>#define PARAM_NAME Param\n#define GETNAME_(a) #a\n#define GETNAME(a) GETNAME_(a)\n\nint Param;\nprintf(\"%s = %i\\n\", GETNAME(PARAM_NAME), PARAM_NAME);\n</code></pre>\n", "OwnerUserId": "6858363", "PostTypeId": "2", "Id": "39616615", "Score": "0", "CreationDate": "2016-09-21T12:30:53.280", "LastActivityDate": "2016-09-21T12:30:53.280"}, "14294465": {"ParentId": "1135822", "PostTypeId": "2", "CommentCount": "2", "Body": "<pre><code>#define HASH_SIGN #\nBOOST_PP_CAT(HASH_SIGN, include)\n</code></pre>\n", "OwnerUserId": "1972534", "LastEditorUserId": "1972534", "LastEditDate": "2013-01-13T05:52:56.650", "Id": "14294465", "Score": "0", "CreationDate": "2013-01-12T14:50:53.210", "LastActivityDate": "2013-01-13T05:52:56.650"}, "1138001": {"ParentId": "1135822", "CommentCount": "3", "Body": "<p>You can't do that.  Preprocessor directives are recognized before macro expansion; if the macro expands into something that looks like a preprocessor directive, that directive will not be recognized.  The best you can do is create a macro for the file name:</p>\n<pre><code>#define MACRO(name) \"name##foo\"\n...\n#include MACRO(Test)\n</code></pre>\n", "OwnerUserId": "134554", "PostTypeId": "2", "Id": "1138001", "Score": "6", "CreationDate": "2009-07-16T14:27:53.250", "LastActivityDate": "2009-07-16T14:27:53.250"}, "1135834": {"ParentId": "1135822", "CommentCount": "2", "Body": "<p>As far as I remember you cannot use another preprocessor directive in define.</p>\n", "OwnerUserId": "72896", "PostTypeId": "2", "Id": "1135834", "Score": "26", "CreationDate": "2009-07-16T06:53:14.713", "LastActivityDate": "2009-07-16T06:53:14.713"}, "1135919": {"ParentId": "1135822", "PostTypeId": "2", "CommentCount": "1", "Body": "<p>This is because the # has special meaning when used in a macro.</p>\n<pre><code>#  means quote the following token (which should be a macro parameter name)\n## means concatenate the preceding and following tokens.\n</code></pre>\n<p>In your situation the # is not followed by a proper token.\nSo in your situation we need to go through a level of indirection:</p>\n<pre><code>#define     QUOTE(name)     #name\n#define     TEST(name)      QUOTE(name ## foo)\n\n#include TEST(scot)\n</code></pre>\n", "OwnerUserId": "14065", "LastEditorUserId": "912144", "LastEditDate": "2011-11-03T15:42:33.627", "Id": "1135919", "Score": "10", "CreationDate": "2009-07-16T07:18:59.997", "LastActivityDate": "2011-11-03T15:42:33.627"}, "bq_ids": {"n4140": {"so_1135822_8289287_0": {"section_id": 532, "quality": 0.9230769230769231, "length": 12}}, "n3337": {"so_1135822_8289287_0": {"section_id": 523, "quality": 0.9230769230769231, "length": 12}}, "n4659": {"so_1135822_8289287_0": {"section_id": 553, "quality": 0.9230769230769231, "length": 12}}}, "1136913": {"ParentId": "1135822", "CommentCount": "1", "Body": "<p>The problem isn't actually getting a # symbol in the output of your preprocessor. </p>\n<p>Apparently you want the preprocessor to reparse your file, to deal with newly created #include directives as part of macro expansion. It doesn't work that way. If a line starts with #, it's an instruction for the preprocessor and interpreted. If a line doesn't start with #, it's only subject to preprocessor transformation including macro substitution. This is a once-per-line test.</p>\n<pre><code>MACRO(Test)\n</code></pre>\n<p>does not start with #. Therefore it is not interpreted as a preprocessor directive; instead it's subject to macro replacement rules.</p>\n", "OwnerUserId": "15416", "PostTypeId": "2", "Id": "1136913", "Score": "26", "CreationDate": "2009-07-16T11:16:12.733", "LastActivityDate": "2009-07-16T11:16:12.733"}});