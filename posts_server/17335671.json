post_cb({"17335671": {"CommentCount": "0", "ViewCount": "137", "CreationDate": "2013-06-27T06:06:58.710", "LastActivityDate": "2013-06-27T06:20:01.817", "Title": "Invocation sequence of constructors and destructors?", "AcceptedAnswerId": "17335694", "PostTypeId": "1", "Id": "17335671", "Score": "0", "Body": "<p>Suppose we have two objects with automatic storage duration:</p>\n<pre><code>{\n   ClassA objA(...);\n   ClassB objB(...);\n\n   // [A] code that uses objA and objB.\n\n   // [B] objA is no longer used after this point.\n\n   // ... more code ...\n\n}  // [C] objA and objB go out of scope.\n</code></pre>\n<ol>\n<li>Does the C++ standard specify the relative sequencing of the constructors for <code>objA</code> and <code>objB</code>?  For example, can we assume that any side-effects caused by <code>objA</code>'s constructor will be visible when <code>objB</code>'s constructor is invoked?</li>\n<li>At [C] destructors for <code>objA</code> and <code>objB</code> will be invoked.   Is there a similar sequencing requirement on these destructors?</li>\n<li>Finally, if liveness analysis shows that <code>objA</code> is dead after point [B], is a C++ compiler allowed to invoke the destructor for <code>objA</code> \"early\", i.e., between points [B] and [C] in the code?</li>\n</ol>\n", "Tags": "<c++><constructor><destructor>", "OwnerUserId": "562505", "AnswerCount": "2"}, "17335758": {"ParentId": "17335671", "PostTypeId": "2", "CommentCount": "0", "Body": "<p>\u00a76.6.2 </p>\n<blockquote>\n<p id=\"so_17335671_17335758_0\">On exit from a scope (however accomplished), objects with automatic storage duration (3.7.3) that have been constructed in that scope are destroyed in the <strong>reverse order</strong> of their construction. </p>\n</blockquote>\n<p>Pretty much answers all of your three questions from this reference.</p>\n", "OwnerUserId": "951757", "LastEditorUserId": "951757", "LastEditDate": "2013-06-27T06:18:47.037", "Id": "17335758", "Score": "2", "CreationDate": "2013-06-27T06:13:16.937", "LastActivityDate": "2013-06-27T06:18:47.037"}, "17335694": {"ParentId": "17335671", "PostTypeId": "2", "CommentCount": "0", "Body": "<blockquote>\n<p id=\"so_17335671_17335694_0\">1 Does the C++ standard specify the relative sequencing of the constructors for objA and objB? For example, can we assume that any side-effects caused by objA's constructor will be visible when objB's constructor is invoked?</p>\n</blockquote>\n<p>Yes. <code>objA</code> is constructed before <code>objB</code>.</p>\n<blockquote>\n<p id=\"so_17335671_17335694_1\">2 At [C] destructors for objA and objB will be invoked. Is there a similar sequencing requirement on these destructors?</p>\n</blockquote>\n<p>Yes, <code>objB</code> is destroyed before <code>objA</code>. The order of destruction is the reverse of the order of construction.</p>\n<blockquote>\n<p id=\"so_17335671_17335694_2\">3 Finally, if liveness analysis shows that objA is dead after point [B], is a C++ compiler allowed to invoke the destructor for objA \"early\", i.e., between points [B] and [C] in the code?</p>\n</blockquote>\n<p>Not if there are side effects. The compiler must follow the <em>as-if</em> rule.</p>\n<p>To clarify: the as-if rule applies to all of the the three points above.</p>\n", "OwnerUserId": "661519", "LastEditorUserId": "661519", "LastEditDate": "2013-06-27T06:20:01.817", "Id": "17335694", "Score": "3", "CreationDate": "2013-06-27T06:08:48.983", "LastActivityDate": "2013-06-27T06:20:01.817"}, "bq_ids": {"n4140": {"so_17335671_17335758_0": {"section_id": 3909, "quality": 0.9444444444444444, "length": 17}}, "n3337": {"so_17335671_17335758_0": {"section_id": 3769, "quality": 0.9444444444444444, "length": 17}}, "n4659": {"so_17335671_17335758_0": {"section_id": 4795, "quality": 0.9444444444444444, "length": 17}}}});