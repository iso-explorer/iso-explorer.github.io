post_cb({"25044767": {"CommentCount": "4", "ViewCount": "94", "PostTypeId": "1", "LastEditorUserId": "3290628", "CreationDate": "2014-07-30T18:56:36.510", "LastActivityDate": "2014-07-30T19:07:46.353", "Title": "Why operator ?: lost lvalue-ness if second or third argument is throwing expression?", "AcceptedAnswerId": "25044958", "LastEditDate": "2014-07-30T19:02:26.830", "Id": "25044767", "Score": "3", "Body": "<p>In C++ operator ?: can be an lvalue if second and third argument is lvalue of same type, for example:</p>\n<pre><code>int foo = 0, bar = 1;\nbool condition = true;\n(condition ? foo : bar) = 42; // correct\n</code></pre>\n<p>Also it is possible to throw something in this operator: </p>\n<pre><code>bar = (condition ? foo : throw 42); // still correct\n</code></pre>\n<p>But this code doesn't compile because left expression is not an lvalue:</p>\n<pre><code>(condition ? foo : throw 42) = bar; // compile error\n</code></pre>\n<p>I check this fact in C++ standart and read this:</p>\n<blockquote>\n<p id=\"so_25044767_25044767_0\">The second or the third operand (but not both) is a throw-expression\n  (15.1); the result is of the type of the other and <strong>is an rvalue</strong>.</p>\n</blockquote>\n<p>What explanation for this rule?</p>\n", "Tags": "<c++>", "OwnerUserId": "3290628", "AnswerCount": "2"}, "25044958": {"ParentId": "25044767", "CommentCount": "4", "Body": "<p>This is <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#1560\">CWG defect 1560</a>. Quoting the defect report:</p>\n<blockquote>\n<p id=\"so_25044767_25044958_0\">A glvalue appearing as one operand of a <em>conditional-expression</em> in\n  which the other operand is a <em>throw-expression</em> is converted to a\n  prvalue, regardless of how the conditional-expression is used: [...]\n  This seems to be gratuitous and surprising.</p>\n</blockquote>\n<p>This is fixed by the resolution of <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#1550\">CWG 1550</a>, now [expr.cond]/2.1 says:</p>\n<blockquote>\n<p id=\"so_25044767_25044958_1\">[If] The second or the third operand (but not both) is a (possibly\n  parenthesized) <em>throw-expression</em>; the result is\n  of the type and value category of the other.</p>\n</blockquote>\n<p>So it should work with a recent compiler.</p>\n", "OwnerUserId": "420683", "PostTypeId": "2", "Id": "25044958", "Score": "5", "CreationDate": "2014-07-30T19:07:44.567", "LastActivityDate": "2014-07-30T19:07:44.567"}, "bq_ids": {"n4140": {"so_25044767_25044958_1": {"section_id": 6168, "quality": 0.9285714285714286, "length": 13}, "so_25044767_25044767_0": {"section_id": 6168, "quality": 0.75, "length": 9}}, "n3337": {"so_25044767_25044958_1": {"section_id": 5929, "quality": 0.6428571428571429, "length": 9}, "so_25044767_25044767_0": {"section_id": 5929, "quality": 0.75, "length": 9}}, "n4659": {"so_25044767_25044958_1": {"section_id": 7665, "quality": 0.9285714285714286, "length": 13}, "so_25044767_25044767_0": {"section_id": 7665, "quality": 0.75, "length": 9}}}, "25044914": {"ParentId": "25044767", "CommentCount": "2", "Body": "<p><code>throw</code> has lower precedence than <code>?:</code> and <code>=</code>.  What you're effectively saying is</p>\n<p><code>condition ? foo : throw (42 = bar);</code></p>\n<p>Obviously <code>42</code> is not assignable as an rvalue.</p>\n<p>Source:  <a href=\"http://en.cppreference.com/w/cpp/language/operator_precedence\" rel=\"nofollow\">http://en.cppreference.com/w/cpp/language/operator_precedence</a></p>\n<p>(Answer refers to syntax of original question...)</p>\n", "OwnerUserId": "3830929", "PostTypeId": "2", "Id": "25044914", "Score": "-1", "CreationDate": "2014-07-30T19:05:05.687", "LastActivityDate": "2014-07-30T19:05:05.687"}});