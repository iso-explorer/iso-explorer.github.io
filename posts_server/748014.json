post_cb({"748014": {"ViewCount": "44739", "Body": "<p>Do I need to manually call <code>close()</code> when I use a <code>std::ifstream</code>?</p>\n<p>For example, in the code:</p>\n<pre><code>std::string readContentsOfFile(std::string fileName) {\n\n  std::ifstream file(fileName.c_str());\n\n  if (file.good()) {\n      std::stringstream buffer;\n      buffer &lt;&lt; file.rdbuf();\n      file.close();\n\n      return buffer.str();\n  }\n  throw std::runtime_exception(\"file not found\");\n}\n</code></pre>\n<p>Do I need to call <code>file.close()</code> manually? Shouldn't <code>ifstream</code> make use of <a href=\"http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization\" rel=\"noreferrer\">RAII</a> for closing files?</p>\n", "AcceptedAnswerId": "748059", "Title": "Do I need to manually close an ifstream?", "CreationDate": "2009-04-14T14:59:26.160", "Id": "748014", "CommentCount": "0", "FavoriteCount": "25", "PostTypeId": "1", "LastEditDate": "2014-11-04T21:19:57.040", "LastEditorUserId": "1950231", "LastActivityDate": "2014-11-04T21:19:57.040", "Score": "134", "OwnerUserId": "61915", "Tags": "<c++><ifstream><raii>", "AnswerCount": "4"}, "6699693": {"Id": "6699693", "PostTypeId": "2", "Body": "<p>I agree with @Martin. If you write to the file, the data may still be sitting on a buffer and may not get written to the file until <code>close()</code> is called. Without doing it manually, you have no idea whether there was an error or not. Not reporting errors to a user is a very bad practice.</p>\n", "LastEditorUserId": "1334550", "LastActivityDate": "2012-11-17T04:26:22.527", "Score": "8", "CreationDate": "2011-07-14T20:45:00.663", "ParentId": "748014", "CommentCount": "0", "LastEditDate": "2012-11-17T04:26:22.527", "OwnerUserId": "845378"}, "750914": {"Id": "750914", "PostTypeId": "2", "Body": "<p>No, this is done automatically by the ifstream destructor. The only reason you should call it manually, is because the fstream instance has a big scope, for example if it is a member variable of a long living class instance.</p>\n", "LastEditorUserId": "449684", "LastActivityDate": "2011-04-29T13:26:58.793", "Score": "4", "CreationDate": "2009-04-15T09:24:43.820", "ParentId": "748014", "CommentCount": "1", "LastEditDate": "2011-04-29T13:26:58.793", "OwnerUserId": "74612"}, "bq_ids": {"n4140": {"so_748014_748059_1": {"length": 6, "quality": 0.8571428571428571, "section_id": 2420}}, "n3337": {"so_748014_748059_1": {"length": 6, "quality": 0.8571428571428571, "section_id": 2405}}, "n4659": {"so_748014_748059_1": {"length": 5, "quality": 0.7142857142857143, "section_id": 2695}}}, "748059": {"Id": "748059", "PostTypeId": "2", "Body": "<p>NO </p>\n<p>This is what RAII is for, let the destructor do its job.  There is no harm in closing it manually, but it's not the C++ way, it's programming in C with classes.</p>\n<p>If you want to close the file before the end of a function you can always use a nested scope.</p>\n<p>In the standard (27.8.1.5 Class template basic_ifstream), <code>ifstream</code> is to be implemented with a <code>basic_filebuf</code> member holding the actual file handle.  It is held as a member so that when an ifstream object destructs, it also calls the destructor on <code>basic_filebuf</code>.  And from the standard (27.8.1.2), that destructor closes the file:</p>\n<blockquote>\n<p id=\"so_748014_748059_0\"><code>virtual \u02dcbasic_filebuf();</code></p>\n<p id=\"so_748014_748059_1\"><strong>Effects:</strong> Destroys an object of class <code>basic_filebuf&lt;charT,traits&gt;</code>. Calls <code>close()</code>.</p>\n</blockquote>\n", "LastEditorUserId": "4928", "LastActivityDate": "2011-05-04T14:14:14.720", "Score": "178", "CreationDate": "2009-04-14T15:09:35.060", "ParentId": "748014", "CommentCount": "13", "LastEditDate": "2011-05-04T14:14:14.720", "OwnerUserId": "8701"}, "748196": {"Id": "748196", "PostTypeId": "2", "Body": "<p>Do you need to close the file?<br>\nNO</br></p>\n<p>Should you close the file?<br>\nDepends.</br></p>\n<p>Do you care about the possible error conditions that could occur if the file fails to close correctly? Remember that close calls setstate(failbit) if it fails. The destructor will call close() for you automatically  because of <strong>RAII</strong> but will not leave you a way of testing the fail bit as the object no longer exists.</p>\n", "LastEditorUserId": "694865", "LastActivityDate": "2012-02-14T19:58:05.153", "Score": "42", "CreationDate": "2009-04-14T15:44:45.477", "ParentId": "748014", "CommentCount": "0", "LastEditDate": "2012-02-14T19:58:05.153", "OwnerUserId": "14065"}});