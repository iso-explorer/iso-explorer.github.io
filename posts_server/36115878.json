post_cb({"36115878": {"CommentCount": "3", "ViewCount": "74", "CreationDate": "2016-03-20T15:45:30.427", "LastActivityDate": "2016-03-20T16:38:07.513", "Title": "How to keep a pointer to a object which is inserted into a set and then pushed into a vector?", "AcceptedAnswerId": "36116463", "PostTypeId": "1", "Id": "36115878", "Score": "1", "Body": "<p>I've got a <code>std::set&lt;std::pair&lt;Point, double&gt;&gt; my_set</code> and a vector <code>std::vector&lt;std::pair&lt;Point, double&gt;*&gt; my_vec</code> which holds pointers to elements in the set. <code>my_set</code> and <code>my_vec</code> are members of a class.</p>\n<p>I've also got a bunch of new <code>Point</code>s which I want to insert into the set <code>my_set</code>, paired with a value (<code>double</code>). I don't know how to keep a pointer to the <code>std::pair&lt;Point, double&gt;</code> object to push this pointer to the <code>my_vec</code>.</p>\n<p>If I do the following in a method A:</p>\n<p><code>auto pair = std::pair&lt;Point(1,2), 0.2&gt;;</code>\n<code>my_set.insert(pair);</code>\n<code>my_vec.push_back(&amp;pair);</code></p>\n<p>I end up with the wrong pairs or even invalid pairs. It should be noted that <code>my_set</code> and <code>my_vec</code> are members of a class and the method A is also from that class. Are my results wrong because the pair object only is valid within the context of that method and by leaving the method it gets invalid? I'm kind of stuck here. Thanks in advance!</p>\n", "Tags": "<c++><pointers><vector><set>", "OwnerUserId": "1447366", "AnswerCount": "1"}, "36116463": {"ParentId": "36115878", "CommentCount": "1", "Body": "<p>The set (as do all iterators from standard library) stores a copy of the object. That means that you should <strong>not</strong> store the initial address of the object.</p>\n<p>You could try to store the address of the element inside the set:</p>\n<pre><code>auto pair = std::pair&lt;Point(1,2), 0.2&gt;;\nauto it = my_set.insert(pair).first;\nmy_vec.push_back(&amp;(*it));\n</code></pre>\n<p>But I could find no assurance that the <em>address</em> of an element remains constant. I could only see in standard draft n2496</p>\n<blockquote>\n<p id=\"so_36115878_36116463_0\">23.2.4 Associative containers [associative.reqmts]<br/>...<br/>\n  9 The insert and emplace members shall not affect the validity of iterators and references to the container,\n  and the erase members shall invalidate only iterators and references to the erased elements.</p>\n</blockquote>\n<p>So IMHO, you'd better store iterators in your vector.</p>\n", "OwnerUserId": "3545273", "PostTypeId": "2", "Id": "36116463", "Score": "1", "CreationDate": "2016-03-20T16:38:07.513", "LastActivityDate": "2016-03-20T16:38:07.513"}, "bq_ids": {"n4140": {"so_36115878_36116463_0": {"section_id": 745, "quality": 0.75, "length": 15}}, "n3337": {"so_36115878_36116463_0": {"section_id": 734, "quality": 0.75, "length": 15}}, "n4659": {"so_36115878_36116463_0": {"section_id": 803, "quality": 0.75, "length": 15}}}});