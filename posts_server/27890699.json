post_cb({"27890699": {"CommentCount": "1", "ViewCount": "173", "PostTypeId": "1", "LastEditorUserId": "596781", "CreationDate": "2015-01-11T18:42:17.520", "LastActivityDate": "2015-01-11T20:49:32.100", "Title": "std::is_same for a not yet defined/declared class", "AcceptedAnswerId": "27890824", "LastEditDate": "2015-01-11T18:42:59.673", "Id": "27890699", "Score": "2", "Body": "<p>Is thw following code, a gcc bug?\nChecking if T type is a not defined yet class Circle, returns false.</p>\n<pre><code>#include &lt;iostream&gt;\n\nusing namespace std;\n\n// uncomment to work\n//struct Circle;\n\nstruct T_traits\n{\n    template&lt;typename T&gt;\n    constexpr static id() { return is_same&lt;T, class Circle&gt;(); }\n};\n\n\nstruct Circle{};\n\nint main()\n{\n    cout &lt;&lt; T_traits::id&lt;Circle&gt;() &lt;&lt; \"\\r\\n\";\n    return 0;\n}\n</code></pre>\n", "Tags": "<c++><c++14>", "OwnerUserId": "1438465", "AnswerCount": "1"}, "27890824": {"ParentId": "27890699", "PostTypeId": "2", "CommentCount": "2", "CreationDate": "2015-01-11T18:55:19.553", "Score": "5", "LastEditorUserId": "3647361", "LastEditDate": "2015-01-11T20:49:32.100", "Id": "27890824", "OwnerUserId": "3647361", "Body": "<pre><code>return is_same&lt;T, class Circle&gt;();\n</code></pre>\n<p>This will actually declare a local class called <code>Circle</code> when you comment out the global declaration. [basic.lookup.elab]/2:</p>\n<blockquote>\n<p id=\"so_27890699_27890824_0\">If the <em>elaborated-type-specifier</em> has no <em>nested-name-specifier</em>, and\n  unless the <em>elaborated-type-specifier</em> appears in a declaration with\n  the following form:<br><br>   \u00a0\u00a0\u00a0\u00a0\u00a0<em>class-key\n  attribute-specifier-seq</em><sub>opt</sub> <em>identifier</em> <code>;</code><br><br>   the\n  identifier is looked up according to 3.4.1 but ignoring any non-type\n  names that have been declared.[..]<br>\n<strong>If the <em>elaborated-type-specifier</em> is introduced by the <em>class-key</em>\n  and this lookup does not find a previously declared <em>type-name</em>\n  [..] the <em>elaborated-type-specifier</em> is a declaration that\n  introduces the <em>class-name</em> as described in 3.3.2.</strong></br></br></br></br></br></p>\n</blockquote>\n<p>The lookup is simple unqualified name lookup as defined in \u00a73.4.1. Lookup is done in the definition context of <code>T_traits</code> as we are not dealing with dependent stuff, so the declaration of <code>Circle</code> right before <code>main</code> is never considered.<br>\n\u00a73.3.2/7 (alias [basic.scope.pdecl]/7):</br></p>\n<blockquote>\n<p id=\"so_27890699_27890824_1\">The point of declaration of a class first declared in an\n  <em>elaborated-type-specifier</em> is as follows:</p>\n<ul>\n<li><p id=\"so_27890699_27890824_2\">for an <em>elaborated-type-specifier</em> of the form</p>\n<p id=\"so_27890699_27890824_3\">\u00a0\u00a0\u00a0\u00a0\u00a0<em>class-key identifier</em></p>\n<p id=\"so_27890699_27890824_4\">if the <em>elaborated-type-specifier</em> is used in the\n  <em>decl-specifier-seq</em> or <em>parameter-declaration-clause</em> of a function defined in namespace scope, the identifier is declared as a\n  <em>class-name</em> in the namespace that contains the declaration; <strong>otherwise</strong>, except as a friend declaration, <strong>the identifier is declared in the smallest namespace or block scope that contains the\n  declaration. [ <em>Note</em>: These rules also apply within templates. \u2014 <em>end\n  note</em> ]</strong></p></li>\n</ul>\n</blockquote>\n<p>However, removing the <code>class</code> keyword won't work either - as mentioned before, the identifier isn't dependent and thus looked up in the definition context. If no declaration is found by this lookup, a diagnostic must be issued by the compiler - even if no specialization is instantiated.</p>\n", "LastActivityDate": "2015-01-11T20:49:32.100"}, "bq_ids": {"n4140": {"so_27890699_27890824_0": {"section_id": 7124, "quality": 0.9166666666666666, "length": 33}, "so_27890699_27890824_4": {"section_id": 7055, "quality": 0.8823529411764706, "length": 30}, "so_27890699_27890824_1": {"section_id": 7055, "quality": 0.875, "length": 7}}, "n3337": {"so_27890699_27890824_0": {"section_id": 6868, "quality": 0.9166666666666666, "length": 33}, "so_27890699_27890824_4": {"section_id": 6799, "quality": 0.8823529411764706, "length": 30}, "so_27890699_27890824_1": {"section_id": 6799, "quality": 0.875, "length": 7}}, "n4659": {"so_27890699_27890824_4": {"section_id": 8552, "quality": 0.8823529411764706, "length": 30}, "so_27890699_27890824_0": {"section_id": 8625, "quality": 0.9166666666666666, "length": 33}, "so_27890699_27890824_1": {"section_id": 8552, "quality": 0.875, "length": 7}}}});