post_cb({"14719330": {"CommentCount": "1", "ViewCount": "140", "PostTypeId": "1", "LastEditorUserId": "508343", "CreationDate": "2013-02-06T00:07:40.303", "LastActivityDate": "2013-02-06T01:00:07.980", "Title": "Which locale will apply to cout after cout.rdbuf(fout.rdbuf())?", "AcceptedAnswerId": "14719384", "LastEditDate": "2013-02-06T01:00:07.980", "Id": "14719330", "Score": "2", "Body": "<pre><code>#include &lt;locale&gt;\n#include &lt;fstream&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nint main()\n{\n    ofstream fout(\"test.txt\");\n\n    fout.imbue(locale(\"chs\"));\n    cout.imbue(locale(\"C\"));\n\n    cout.rdbuf(fout.rdbuf());\n    cout &lt;&lt; \"\u4e2d\u6587\"; // Which locale will apply to here? \"C\" or \"chs\"?\n}\n</code></pre>\n<p>The question is commented in the code.</p>\n", "Tags": "<c++><unicode><internationalization><locale><iostream>", "OwnerUserId": "508343", "AnswerCount": "1"}, "14719384": {"ParentId": "14719330", "PostTypeId": "2", "CommentCount": "0", "Body": "<p>From <a href=\"http://www.cplusplus.com/reference/ios/ios/imbue/\" rel=\"nofollow\">http://www.cplusplus.com/reference/ios/ios/imbue/</a></p>\n<blockquote>\n<p id=\"so_14719330_14719384_0\"><code>std::ios::imbue &lt;ios&gt;</code></p>\n<p id=\"so_14719330_14719384_1\"><code>locale imbue ( const locale&amp; loc );</code></p>\n<p id=\"so_14719330_14719384_2\"><strong>Imbue locale</strong></p>\n<p id=\"so_14719330_14719384_3\">Associates loc to both the stream and its associated stream buffer (if\n  any) as the new locale object to be used with locale-sensitive\n  operations.</p>\n<p id=\"so_14719330_14719384_4\">All callback functions registered with register_callback with\n  imbue_event as its first parameter are called.</p>\n<p id=\"so_14719330_14719384_5\">In fact, this member function calls its inherited homonym\n  ios_base::imbue(loc), and if the stream is associated with a stream\n  buffer, <strong>also calls rdbuf()-&gt;pubimbue(loc).</strong></p>\n</blockquote>\n<p>Also, see <a href=\"http://stdcxx.apache.org/doc/stdlibug/27-4.html\" rel=\"nofollow\">http://stdcxx.apache.org/doc/stdlibug/27-4.html</a></p>\n<blockquote>\n<p id=\"so_14719330_14719384_6\"><strong>27.4.4 Collaboration of Locales and Iostreams</strong></p>\n<p id=\"so_14719330_14719384_7\">The base class ios_base contains a locale object. <strong>The formatting and\n  parsing functions defined by the derived stream classes use the\n  numeric facets of that locale.</strong></p>\n<p id=\"so_14719330_14719384_8\">The class template basic_ios holds a pointer to the stream buffer.\n  This stream buffer has a locale object, too, usually a copy of the\n  same locale object used by the functions of the stream classes. <strong>The\n  stream buffer's input and output functions use the code conversion\n  facet of the attached locale.</strong></p>\n</blockquote>\n<p>In your case, it would use the \"C\" numeric locale and the \"chs\" character locale.</p>\n", "OwnerUserId": "251860", "LastEditorUserId": "251860", "LastEditDate": "2013-02-06T00:23:51.823", "Id": "14719384", "Score": "2", "CreationDate": "2013-02-06T00:12:32.543", "LastActivityDate": "2013-02-06T00:23:51.823"}, "bq_ids": {"n4140": {"so_14719330_14719384_1": {"section_id": 6373, "quality": 0.8, "length": 4}}, "n3337": {"so_14719330_14719384_1": {"section_id": 6130, "quality": 0.8, "length": 4}}, "n4659": {"so_14719330_14719384_1": {"section_id": 2821, "quality": 0.8, "length": 4}}}});