post_cb({"27429310": {"CommentCount": "1", "AcceptedAnswerId": "27429416", "PostTypeId": "1", "LastEditorUserId": "2460632", "CreationDate": "2014-12-11T17:54:01.347", "LastActivityDate": "2014-12-11T19:07:30.767", "LastEditDate": "2014-12-11T17:59:40.493", "ViewCount": "63", "FavoriteCount": "0", "Title": "Success of write with simultaneous read", "Id": "27429310", "Score": "1", "Body": "<p>If one thread in a program attempts to read from a variable while another writes to it, the value read is of course undefined. However, assuming there is only one writer, is the write guaranteed to succeed? For example:</p>\n<pre><code>bool myGlobalVariable = false;\nvoid thread1() {\n    myGlobalVariable = true;\n}\nvoid thread2() {\n    bool x = myGlobalVariable; //x is undefined\n}\n</code></pre>\n<p>In this case, once both threads are finished, is <code>myGlobalVariable</code> guaranteed to be <code>true</code>? </p>\n<p>I'm specifically wondering about gcc on linux, but I'd be interested to know what other operating systems and compilers do, or if ARM behaves differently than x86.</p>\n", "Tags": "<c++><multithreading>", "OwnerUserId": "2460632", "AnswerCount": "2"}, "27429416": {"ParentId": "27429310", "PostTypeId": "2", "CommentCount": "9", "Body": "<p>I can't see how this could possibly fail to write the value under any circumstances, if it's just a write and not a read.</p>\n<p>The reason that multithreaded access to the same variable is dangerous is precisely that there's <em>no checking</em> being done as to whether the variable is being modified during an operation. It's not that it might check and then complain.</p>\n<p>So in the case of a single write, and just a write (so no <code>i++</code>, which is a read as well), it must succeed.</p>\n<p>Of course, you could design hardware that would fail if you wanted to, but I don't see how any standard architecture could fail.</p>\n<p>As Anton points out in his answer, the spec says it's undefined behaviour, and so it would be possible to write a valid C++ compiler that deliberately watches out for such behaviour and randomises the result. But no compiler is going to do that in practice.</p>\n<p>That said, it's never a good idea to rely on behaviour that's officially undefined, so as the comment from jeffamaphone says, the right answer to your question is that the write will succeed, but you still shouldn't do it.</p>\n", "OwnerUserId": "3933089", "LastEditorUserId": "3933089", "LastEditDate": "2014-12-11T19:07:30.767", "Id": "27429416", "Score": "1", "CreationDate": "2014-12-11T18:00:47.547", "LastActivityDate": "2014-12-11T19:07:30.767"}, "bq_ids": {"n4140": {"so_27429310_27429614_1": {"section_id": 5817, "quality": 0.9375, "length": 15}, "so_27429310_27429614_0": {"section_id": 5834, "quality": 0.90625, "length": 29}}, "n3337": {"so_27429310_27429614_1": {"section_id": 5588, "quality": 0.9375, "length": 15}, "so_27429310_27429614_0": {"section_id": 5605, "quality": 0.625, "length": 20}}, "n4659": {"so_27429310_27429614_1": {"section_id": 7278, "quality": 0.875, "length": 14}, "so_27429310_27429614_0": {"section_id": 7296, "quality": 0.90625, "length": 29}}}, "27429614": {"ParentId": "27429310", "CommentCount": "0", "Body": "<p>In practice nothing probably will fail. However, the C++11/14 standard is pretty clear in this regard. Here is a quote from C++14 draft section <code>[intro.multithread]/23</code> (emphasis mine):</p>\n<blockquote>\n<p id=\"so_27429310_27429614_0\">The execution of a program contains a <em>data race</em> if it contains two potentially concurrent conflicting actions, at least one of which is not atomic, and neither happens before the other, except for the special case for signal handlers described below. <strong>Any such data race results in undefined behavior.</strong></p>\n</blockquote>\n<p>Where conflicting actions are defined at <code>[intro.multithread]/6</code>:</p>\n<blockquote>\n<p id=\"so_27429310_27429614_1\">Two expression evaluations <em>conflict</em> if one of them modifies a memory location (1.7) and the other one accesses or modifies the same memory location.</p>\n</blockquote>\n", "OwnerUserId": "3959454", "PostTypeId": "2", "Id": "27429614", "Score": "2", "CreationDate": "2014-12-11T18:11:04.917", "LastActivityDate": "2014-12-11T18:11:04.917"}});