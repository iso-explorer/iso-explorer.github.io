post_cb({"30498280": {"LastEditDate": "2015-05-28T06:01:35.000", "Body": "<p>My task is to make a <strong>Qt dll</strong>, which will be used in <strong>Visual Basic</strong>.\nI found a couple articles, which says about making C++ dlls for VB, but, looks like, there is something special for Qt, so no matter how much did i try to do it, it just doesn't work.</p>\n<p>First I found an <a href=\"https://msdn.microsoft.com/en-gb/library/dt232c9t.aspx\" rel=\"nofollow\">article</a> about making C/C++ dlls for VB. At the end of the article it says: </p>\n<blockquote>\n<p id=\"so_30498280_30498280_0\">For DLLs to be called by programs written in Visual Basic, the alias\n  technique shown in this topic is needed in the .def file.</p>\n</blockquote>\n<p>It was pretty hard to understand, how to even add a .def file to a Qt project.\nI'm not sure, but it looks like <code>DEF_FILE = def.def</code> is worked.\nIn def.def I wrote</p>\n<pre><code>LIBRARY TestLibrary\nEXPORTS\n    SUM = _sum@#\n</code></pre>\n<p>for function   </p>\n<pre><code>int __stdcall func sum(int a, int b) { return a + b; }\n</code></pre>\n<p>'#' - because I don't know </p>\n<blockquote>\n<p id=\"so_30498280_30498280_1\">number of bytes in the argument list (the required stack space)</p>\n</blockquote>\n<p>For this we need to use /MAP, which I didn't found how to use in Qt</p>\n<p>Then I tried <a href=\"https://msdn.microsoft.com/en-gb/library/d91k01sh.aspx\" rel=\"nofollow\">this</a> like so:</p>\n<pre><code>int sum(int a, int b) { return a + b; }\n\nLIBRARY TestLibrary\nEXPORTS\n    sum     @1\n</code></pre>\n<p>and it doesn't work too.</p>\n<p>And [this][3] is a dead duck too.</p>\n<p>[This][4] question has no ansver for me.</p>\n<p><strong>All of my code:</strong></p>\n<blockquote>\n<p id=\"so_30498280_30498280_2\">TestLibrary.pro</p>\n</blockquote>\n<pre><code>QT       -= gui\n\nTARGET = TestLibrary\nTEMPLATE = lib\n\nVERSION = 1.0.0\n\nDEFINES += TESTLIBRARY_LIBRARY\n\nSOURCES += testlibrary.cpp\n\nHEADERS += testlibrary.h\\\n    testlibrary_global.h\n\nDEF_FILE = def.def\n\nunix {\n    target.path = /usr/lib\n    INSTALLS += target\n}\n\nDISTFILES += \\\n    def.def\n</code></pre>\n<blockquote>\n<p id=\"so_30498280_30498280_3\">testlibrary.h</p>\n</blockquote>\n<pre><code>#ifndef TESTLIBRARY_H\n#define TESTLIBRARY_H\n\n#include \"testlibrary_global.h\"\n#include &lt;stddef.h&gt;\n\nclass TESTLIBRARYSHARED_EXPORT TestLibrary\n{\npublic:\n    int sum(int a, int b) { return a + b; }\n};\n\n#endif // TESTLIBRARY_H\n</code></pre>\n<blockquote>\n<p id=\"so_30498280_30498280_4\">testlibrary_global.h</p>\n</blockquote>\n<pre><code>#ifndef TESTLIBRARY_GLOBAL_H\n#define TESTLIBRARY_GLOBAL_H\n\n#include &lt;QtCore/qglobal.h&gt;\n\n#if defined(TESTLIBRARY_LIBRARY)\n#   define TESTLIBRARYSHARED_EXPORT Q_DECL_EXPORT\n#else\n#   define TESTLIBRARYSHARED_EXPORT Q_DECL_IMPORT\n#endif\n\n#endif // TESTLIBRARY_GLOBAL_H\n</code></pre>\n<blockquote>\n<p id=\"so_30498280_30498280_5\">testlibrary.cpp</p>\n</blockquote>\n<pre><code>#include \"testlibrary.h\"\n</code></pre>\n<blockquote>\n<p id=\"so_30498280_30498280_6\">def.def</p>\n</blockquote>\n<pre><code>LIBRARY TestLibrary\nEXPORTS\n    sum     @1\n</code></pre>\n<p>PS sorry for my awful english =P</p>\n<p>3: https:// msdn.microsoft .com/en-gb/library/a90k134d.aspx</p>\n<p>4: https:// stackoverflow .com/questions/19730906/using-my-c-qt-library-dll-in-visual-basic</p>\n", "CreationDate": "2015-05-28T05:55:55.667", "Score": "1", "CommentCount": "0", "OwnerUserId": "4939348", "Title": "Make Qt dll and use it in Visual Basic", "LastActivityDate": "2015-05-28T06:01:35.000", "PostTypeId": "1", "Tags": "<c++><vb.net><qt><dll>", "AnswerCount": "0", "FavoriteCount": "0", "Id": "30498280", "ViewCount": "174", "LastEditorUserId": "4939348"}, "bq_ids": {"n3337": {"so_30498280_30498280_1": {"quality": 0.5714285714285714, "length": 4, "section_id": 5541}}}});