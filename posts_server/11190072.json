post_cb({"11190072": {"ViewCount": "1040", "Body": "<p>The following code works fine on Linux but throws an exception on OS X 10.7:</p>\n<pre><code>#include &lt;iostream&gt;\n#include &lt;locale&gt;\n#include &lt;stdexcept&gt;\n\nint main() try {\n    std::locale::global(std::locale(\"\"));\n    std::cout &lt;&lt; \"Using locale: \" &lt;&lt; std::locale().name() &lt;&lt; \"\\n\";\n}\ncatch (std::runtime_error const&amp; e) {\n    std::cout &lt;&lt; e.what() &lt;&lt; \"\\n\";\n    return 1;\n}\n</code></pre>\n<p>The output on OS X is:</p>\n<blockquote>\n<p id=\"so_11190072_11190072_0\"><code>locale::facet::_S_create_c_locale</code> name not valid</p>\n</blockquote>\n<p>However, the standard explicitly says that</p>\n<blockquote>\n<p id=\"so_11190072_11190072_1\">The set of valid string argument values is <code>\"C\"</code>, <code>\"\"</code>, and any implementation-defined values.</p>\n</blockquote>\n<p>So whatever causes the behaviour above is violating the standard.</p>\n<p>The compiler used is clang++ 3.1 (tags/Apple/clang-318.0.58); I\u2019ve also tried it with GCC 4.7, installed via Homebrew, with the same result.</p>\n<p><strong>Can other people validate this problem? What causes it? Am I doing anything wrong? Is this a bug in OS X?</strong></p>\n<p>(Maybe this <a href=\"https://stackoverflow.com/q/9451419/1968\">relates to another <code>xlocale</code> problem</a> but the errors are actually completely different.)</p>\n", "AcceptedAnswerId": "11192040", "Title": "Setting locales on OS X crashes", "CreationDate": "2012-06-25T13:12:34.533", "Id": "11190072", "CommentCount": "4", "FavoriteCount": "2", "PostTypeId": "1", "LastEditDate": "2017-05-23T12:23:07.427", "LastEditorUserId": "-1", "LastActivityDate": "2014-06-26T15:30:30.570", "Score": "8", "OwnerUserId": "1968", "Tags": "<c++><osx><locale><xlocale>", "AnswerCount": "2"}, "bq_ids": {"n4140": {"so_11190072_11190072_1": {"length": 6, "quality": 0.75, "section_id": 6395}}, "n3337": {"so_11190072_11190072_1": {"length": 6, "quality": 0.75, "section_id": 6154}}, "n4659": {"so_11190072_11190072_1": {"length": 6, "quality": 0.75, "section_id": 7907}}}, "11192040": {"Id": "11192040", "PostTypeId": "2", "Body": "<p>I don't think you're using xlocale. I believe that your problem is with libstdc++, which uses a different locale support library that is not supported on OS X, as the question EitanT links to states.</p>\n<p>If you switch to libc++ your program will work.</p>\n", "LastEditorUserId": "365496", "LastActivityDate": "2014-06-26T15:30:30.570", "Score": "2", "CreationDate": "2012-06-25T15:13:18.497", "ParentId": "11190072", "CommentCount": "0", "LastEditDate": "2014-06-26T15:30:30.570", "OwnerUserId": "365496"}, "22316761": {"Id": "22316761", "PostTypeId": "2", "Body": "<p>The poster above it correct...the problem is with libstdc++.  I wanted to add my answer because it is not straightforward how to get OS X to link against libc++ and took me over an hour to figure out.</p>\n<p>Invoking the compiler/linker by <code>g++ -libstd=libc++</code> or by <code>clang++ -libstd=libc++</code> or by the alias <code>c++ -libstd=libc++</code> will all fail.</p>\n<p>The solution for compiling simple programs from the command line instead of messing with the added overhead of Xcode is to allow Xcode to handle the linking by using the command <code>xcrun clang++ -stdlib=libc++</code></p>\n<p><code>xcrun</code> allows Xcode to manage the tool chain and will build a successful executable where <code>cout.imbue(locale(foo))</code> will successfully work.</p>\n", "LastActivityDate": "2014-03-11T04:54:27.660", "Score": "0", "CreationDate": "2014-03-11T04:54:27.660", "ParentId": "11190072", "CommentCount": "3", "OwnerUserId": "3176017"}});