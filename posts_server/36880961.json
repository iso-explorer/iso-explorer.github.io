post_cb({"36881048": {"ParentId": "36880961", "CommentCount": "0", "Body": "<p>According to the C++ standard <strong>[support.runtime]</strong>, when discussing the second parameter to <code>va_start</code>:</p>\n<blockquote>\n<p id=\"so_36880961_36881048_0\">The parameter <em>parmN</em> is the identifier of the rightmost parameter in the variable parameter list of the function de\ufb01nition (the one just before the <code>...</code>). <strong>If the parameter <em>parmN</em> is of a reference type</strong>, or of a type that is not compatible with the type that results when passing an argument for which there is no parameter, <strong>the behavior is unde\ufb01ned</strong>.</p>\n</blockquote>\n<p>Emphasis mine. Your <code>format</code> parameter is a reference type, hence its use as the last parameter before the <code>...</code> results in undefined behavior.</p>\n", "OwnerUserId": "902497", "PostTypeId": "2", "Id": "36881048", "Score": "4", "CreationDate": "2016-04-27T05:30:52.227", "LastActivityDate": "2016-04-27T05:30:52.227"}, "36880961": {"CommentCount": "2", "ViewCount": "75", "PostTypeId": "1", "ClosedDate": "2016-04-27T06:37:06.713", "LastEditorUserId": "972202", "CreationDate": "2016-04-27T05:23:07.190", "LastActivityDate": "2016-04-27T05:30:52.227", "Title": "Cause of Variadic Arguments being corrupted/null", "AcceptedAnswerId": "36881048", "LastEditDate": "2016-04-27T05:26:17.660", "Id": "36880961", "Score": "1", "Body": "<p>I have a wrapper function that allows me to achieve the result of <code>sprintf</code> by writing one line of code instead of 3.</p>\n<pre><code>void output(const tstring&amp; format, ...)\n{\n    va_list args;\n    va_start(args, format);\n\n    const int len = _vsctprintf(format.c_str(), args) + 1;\n    TCHAR* buf = new TCHAR[len];\n\n    _vstprintf(buf, format.c_str(), args);\n    OutputDebugString(buf);\n\n    delete[] buf;\n}\n</code></pre>\n<p>My problem: The variadic arguments are corrupted. </p>\n<p>For example;</p>\n<pre><code>output(_T(\"%d\\n\"), 1); // outputs: -858993460\noutput(_T(\"%d\\n\"), 2); // outputs: -858993460\n</code></pre>\n<p>Whats the cause of this error and how can I fix it?</p>\n", "Tags": "<c++><winapi>", "OwnerUserId": "972202", "AnswerCount": "1"}, "bq_ids": {"n4140": {"so_36880961_36881048_0": {"section_id": 6966, "quality": 0.896551724137931, "length": 26}}, "n3337": {"so_36880961_36881048_0": {"section_id": 6713, "quality": 0.896551724137931, "length": 26}}, "n4659": {"so_36880961_36881048_0": {"section_id": 8465, "quality": 0.8620689655172413, "length": 25}}}});