post_cb({"41915587": {"CommentCount": "5", "ViewCount": "188", "PostTypeId": "1", "LastEditorUserId": "560648", "CreationDate": "2017-01-28T22:33:27.013", "LastActivityDate": "2017-03-14T17:41:37.283", "Title": "extern template 'inconsistent explicit instantiations'", "AcceptedAnswerId": "41916709", "LastEditDate": "2017-03-14T17:41:37.283", "Id": "41915587", "Score": "6", "Body": "<p>Given</p>\n<pre><code>#include &lt;vector&gt;\n\n// Case I: error\n</code></pre>\n<blockquote>\n<p id=\"so_41915587_41915587_0\">error C2961: 'std::vector&gt;': inconsistent\n  explicit instantiations, a previous explicit instantiation did not\n  specify 'extern template'</p>\n</blockquote>\n<pre><code>template class std::vector&lt;int&gt;;\nextern template class std::vector&lt;int&gt;;\n\n\n// Case II: fine\n//extern template class std::vector&lt;int&gt;;\n//template class std::vector&lt;int&gt;;\n\n// Case III: fine\n//extern template class std::vector&lt;int&gt;;\n//template class std::vector&lt;int&gt;;\n//template class std::vector&lt;int&gt;;\n\n// Case IV: fine\n//extern template class std::vector&lt;int&gt;;\n//extern template class std::vector&lt;int&gt;;\n//template class std::vector&lt;int&gt;;\n//template class std::vector&lt;int&gt;;\n\n\nint main()\n{\n\n}\n</code></pre>\n<p>I build the code with VS2015 Version 4.6 and see the C2961 error. However, I don't see the error with compiler <a href=\"http://gcc.godbolt.org/\" rel=\"nofollow noreferrer\">http://gcc.godbolt.org/</a>.</p>\n<p>Is this a bug with VS2015?</p>\n", "Tags": "<c++><c++11><c++14>", "OwnerUserId": "391104", "AnswerCount": "1"}, "41916709": {"ParentId": "41915587", "CommentCount": "0", "Body": "<p>MSVC and Clang are right to issue an error in this case. [temp.explicit]/11 in the standard says:</p>\n<blockquote>\n<p id=\"so_41915587_41916709_0\">If an entity is the subject of both an explicit instantiation\n  declaration and an explicit instantiation definition in the same\n  translation unit, the definition shall follow the declaration. [...]</p>\n</blockquote>\n<p><code>template class std::vector&lt;int&gt;;</code> is an explicit instantiation definition. The one with the <code>extern</code> is an explicit instantiation declaration.</p>\n<hr>\n<p>Note that explicitly instantiating <code>std::vector&lt;int&gt;</code> is ill-formed in any case according to [namespace.std]/2:</p>\n<blockquote>\n<p id=\"so_41915587_41916709_1\">[...] A program may explicitly instantiate a template defined in the\n  standard library only if the declaration depends on the name of a\n  user-defined type and the instantiation meets the standard library\n  requirements for the original template.</p>\n</blockquote>\n<p>Also note that cases III and IV are also ill-formed according to [temp.spec]/5:</p>\n<blockquote>\n<p id=\"so_41915587_41916709_2\">For a given template and a given set of <em>template-arguments</em>,</p>\n<ul>\n<li>an explicit instantiation definition shall appear at most once in a program,  </li>\n</ul>\n<p id=\"so_41915587_41916709_3\">[...]</p>\n<p id=\"so_41915587_41916709_4\">An implementation is not required to diagnose a violation of this\n  rule.</p>\n</blockquote>\n</hr>", "OwnerUserId": "4326278", "PostTypeId": "2", "Id": "41916709", "Score": "6", "CreationDate": "2017-01-29T01:23:59.297", "LastActivityDate": "2017-01-29T01:23:59.297"}, "bq_ids": {"n4140": {"so_41915587_41916709_0": {"section_id": 260, "quality": 1.0, "length": 15}, "so_41915587_41916709_1": {"section_id": 6300, "quality": 1.0, "length": 17}, "so_41915587_41916709_4": {"section_id": 231, "quality": 1.0, "length": 5}, "so_41915587_41916709_2": {"section_id": 231, "quality": 0.8333333333333334, "length": 5}}, "n3337": {"so_41915587_41916709_0": {"section_id": 251, "quality": 1.0, "length": 15}, "so_41915587_41916709_1": {"section_id": 6057, "quality": 1.0, "length": 17}, "so_41915587_41916709_4": {"section_id": 224, "quality": 1.0, "length": 5}, "so_41915587_41916709_2": {"section_id": 224, "quality": 0.8333333333333334, "length": 5}}, "n4659": {"so_41915587_41916709_1": {"section_id": 7809, "quality": 1.0, "length": 17}, "so_41915587_41916709_2": {"section_id": 239, "quality": 0.8333333333333334, "length": 5}, "so_41915587_41916709_0": {"section_id": 267, "quality": 1.0, "length": 15}, "so_41915587_41916709_4": {"section_id": 239, "quality": 1.0, "length": 5}}}});