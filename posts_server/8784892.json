post_cb({"8784892": {"CommentCount": "3", "AcceptedAnswerId": "8785008", "PostTypeId": "1", "LastEditorUserId": "3777958", "CreationDate": "2012-01-09T06:59:59.763", "LastActivityDate": "2015-12-03T13:55:35.133", "LastEditDate": "2015-12-03T13:55:35.133", "ViewCount": "3310", "FavoriteCount": "5", "Title": "Is std::cout guaranteed to be initialized?", "Id": "8784892", "Score": "32", "Body": "<p>What I know about C++ is that the order of the constructions (and destructions) of global instances should not be assumed.</p>\n<p>While I'm writing code with a global instance which uses <code>std::cout</code> in the constructor &amp; destructor, I got a question.</p>\n<p><code>std::cout</code> is also a global instance of iostream. Is <code>std::cout</code> guaranteed to be initialized before any other global instances?</p>\n<p>I wrote a simple test code and it works perfectly, but still I don't know why.</p>\n<pre><code>#include &lt;iostream&gt;\n\nstruct test\n{\n    test() { std::cout &lt;&lt; \"test::ctor\" &lt;&lt; std::endl; }\n    ~test() { std::cout &lt;&lt; \"test::dtor\" &lt;&lt; std::endl; }\n};\n\ntest t;\n\nint main()\n{\n    std::cout &lt;&lt; \"Hello world\" &lt;&lt; std::endl;\n    return 0;\n}\n</code></pre>\n<p>It prints</p>\n<pre><code>test::ctor\nHello world\ntest::dtor\n</code></pre>\n<p>Is there any possibility that the code doesn't run as expected?</p>\n", "Tags": "<c++><constructor><global-variables>", "OwnerUserId": "1030861", "AnswerCount": "3"}, "8784923": {"ParentId": "8784892", "PostTypeId": "2", "CommentCount": "7", "Body": "<p>According to <strong>\u00a727.3/2</strong>:</p>\n<blockquote>\n<p id=\"so_8784892_8784923_0\">The objects [std::cin, std::cout, etc.] are constructed, and the\n  associations are established at some time prior to or during first\n  time an object of class ios_base::Init is constructed, and in any case\n  before the body of main begins execution.</p>\n</blockquote>\n", "OwnerUserId": "619570", "LastEditorUserId": "2349936", "LastEditDate": "2015-11-21T20:10:25.820", "Id": "8784923", "Score": "10", "CreationDate": "2012-01-09T07:03:34.313", "LastActivityDate": "2015-11-21T20:10:25.820"}, "8784945": {"ParentId": "8784892", "PostTypeId": "2", "CommentCount": "0", "Body": "<p>Your question is about the order of construction of static objects. I believe that the language specification leaves it undefined.</p>\n<p>GCC has the <a href=\"http://gcc.gnu.org/onlinedocs/gcc-4.6.2/gcc/C_002b_002b-Attributes.html\" rel=\"nofollow\">init_priority</a> attribute to play with the order.</p>\n<p>And I believe you should not worry that much in practice.</p>\n", "OwnerUserId": "841108", "LastEditorUserId": "841108", "LastEditDate": "2012-01-09T08:46:10.473", "Id": "8784945", "Score": "2", "CreationDate": "2012-01-09T07:05:35.063", "LastActivityDate": "2012-01-09T08:46:10.473"}, "bq_ids": {"n4140": {"so_8784892_8784923_0": {"section_id": 1920, "quality": 0.8333333333333334, "length": 20}}, "n3337": {"so_8784892_8784923_0": {"section_id": 1909, "quality": 0.8333333333333334, "length": 20}}, "n4659": {"so_8784892_8784923_0": {"section_id": 2191, "quality": 0.8333333333333334, "length": 20}}}, "8785008": {"ParentId": "8784892", "CommentCount": "1", "Body": "<p>The answer differs depending on if you're using C++03 or C++11.</p>\n<p>In C++11, your code is guaranteed to work, but in C++03 it's unspecified; your only guarantee is that by the time <code>main()</code> is entered, the standard streams had been initialized. (That said, all mainstream implementations initialize them prior to running any dynamic initialization, making them fine to use.)</p>\n<p>You can force initialization by constructing an <code>std::ios_base::Init</code> object, like so:</p>\n<pre><code>#include &lt;iostream&gt;\n\nstruct test\n{\n    test() { std::cout &lt;&lt; \"test::ctor\" &lt;&lt; std::endl; }\n    ~test() { std::cout &lt;&lt; \"test::dtor\" &lt;&lt; std::endl; }\n\nprivate:\n    std::ios_base::Init mInitializer;\n};\n\ntest t;\n\nint main()\n{\n    std::cout &lt;&lt; \"Hello world\" &lt;&lt; std::endl;\n    return 0;\n}\n</code></pre>\n<p>Now when <code>test</code> constructs, it initializes <code>mInitializer</code> and guarantees the streams are ready to use.</p>\n<p>C++11 fixed this slightly annoying behavior by acting as if every instance of <code>#include &lt;iostream&gt;</code> where followed by <code>static std::ios_base::Init __unspecified_name__;</code>. This automatically guarantees the streams are ready to use.</p>\n", "OwnerUserId": "87234", "PostTypeId": "2", "Id": "8785008", "Score": "35", "CreationDate": "2012-01-09T07:11:04.533", "LastActivityDate": "2012-01-09T07:11:04.533"}});