post_cb({"bq_ids": {"n4140": {"so_24142110_24142110_0": {"length": 10, "quality": 0.9090909090909091, "section_id": 2693}}, "n3337": {"so_24142110_24142110_0": {"length": 10, "quality": 0.9090909090909091, "section_id": 2655}}, "n4659": {"so_24142110_24142110_0": {"length": 10, "quality": 0.9090909090909091, "section_id": 3433}}}, "24142110": {"ViewCount": "911", "Body": "<p>I would like to know how many different threads used an object function during its lifetime.</p>\n<p>My naive approach was to create a base class to register the id of calling threads :</p>\n<pre><code>class threaded_object\n{\npublic:\n    virtual ~threaded_object() {}\n\nprotected:\n    void register_call()\n    {\n                    // error ! if the ID is reused, the new thread wont be accounted for.\n        callers_ids.insert(std::this_thread::get_id());\n    }\n\n    size_t get_threads_cout() const\n    {\n        return callers_ids.size();\n    }\n\nprivate:\n    std::set&lt;std::thread::id&gt; callers_ids;\n};\n</code></pre>\n<p>And to inherits it in my client classes, here I will count how many threads used foo()</p>\n<pre><code>class MyObject : public threaded_object\n{\n void foo()\n {\n    register_call();\n    // ...\n }\n};\n</code></pre>\n<p>But it doesn't work in the general case, the standards says in section \u00a7 30.3.1.1</p>\n<blockquote>\n<p id=\"so_24142110_24142110_0\">The library may reuse the value of a thread::id of a terminated thread\n  that can no longer be joined</p>\n</blockquote>\n<p><strong>Question:</strong></p>\n<p>Is there a portable and safe way to do this ?</p>\n", "Title": "C++ : How to count the number of threads used to call a function?", "CreationDate": "2014-06-10T13:19:25.293", "LastActivityDate": "2014-06-10T14:04:54.450", "CommentCount": "5", "FavoriteCount": "1", "PostTypeId": "1", "LastEditDate": "2014-06-10T13:41:35.440", "LastEditorUserId": "3510483", "Id": "24142110", "Score": "2", "OwnerUserId": "3510483", "Tags": "<c++><multithreading><c++11>", "AnswerCount": "1"}, "24143096": {"Id": "24143096", "PostTypeId": "2", "Body": "<p>I believe you can use thread-local storage to count how many threads called your function:</p>\n<pre><code>namespace {\n    thread_local bool used = false;\n}\n\n\nvoid register_call()\n{\n    if( !used ) {\n        used = true;\n        ++count;\n    }\n}\n</code></pre>\n<p>Of course this code is to show the idea, in real code it can be a pointer to container, that holds addresses of functions which are in interest etc.</p>\n", "LastActivityDate": "2014-06-10T14:04:54.450", "CommentCount": "2", "CreationDate": "2014-06-10T14:04:54.450", "ParentId": "24142110", "Score": "1", "OwnerUserId": "432358"}});