post_cb({"31537359": {"CommentCount": "0", "AcceptedAnswerId": "31537697", "PostTypeId": "1", "LastEditorUserId": "-1", "CreationDate": "2015-07-21T11:07:38.730", "LastActivityDate": "2015-07-21T13:58:18.920", "LastEditDate": "2017-05-23T12:29:47.080", "ViewCount": "216", "FavoriteCount": "1", "Title": "`const int a = 1;` is `a` a constant expression, if `a` has automatic storage duration", "Id": "31537359", "Score": "1", "Body": "<p>N4527 5.20[expr.const]p2</p>\n<blockquote>\n<p id=\"so_31537359_31537359_0\">A conditional-expression e is a <strong>core constant expression</strong> unless the evaluation of e, following the rules of the\n  abstract machine (1.9), would evaluate one of the following expressions:</p>\n<p id=\"so_31537359_31537359_1\">(2.7) \u2014 an lvalue-to-rvalue conversion (4.1) unless it is applied to</p>\n<p id=\"so_31537359_31537359_2\">(2.7.1) \u2014 <strong>a non-volatile glvalue of integral or enumeration type that refers to a complete non-volatile const\n  object with a preceding initialization, initialized with a constant expression, or</strong></p>\n<p id=\"so_31537359_31537359_3\">(2.7.2) \u2014 a non-volatile glvalue that refers to a subobject of a string literal (2.13.5), or</p>\n<p id=\"so_31537359_31537359_4\">(2.7.3) \u2014 a non-volatile glvalue that refers to a non-volatile object defined with constexpr, or that refers\n  to a non-mutable sub-object of such an object, or</p>\n<p id=\"so_31537359_31537359_5\">(2.7.4) \u2014 a non-volatile glvalue of literal type that refers to a non-volatile object whose lifetime began\n  within the evaluation of e;</p>\n</blockquote>\n<p>5.20[expr.const]p5</p>\n<blockquote>\n<p id=\"so_31537359_31537359_6\">A constant expression is either a <strong>glvalue core constant expression</strong> whose value refers to an entity that is a\n  permitted result of a constant expression (as defined below), or a prvalue core constant expression whose\n  value is an object where, for that object and its subobjects: </p>\n<p id=\"so_31537359_31537359_7\">\u2014 each non-static data member of reference type refers to an entity that is a permitted result of a constant expression, and</p>\n<p id=\"so_31537359_31537359_8\">\u2014 if the object or subobject is of pointer type, it contains the address of an object with static storage duration, the address past the end of such an object (5.7), the address of a function, or a null pointer value.</p>\n<p id=\"so_31537359_31537359_9\">An entity is a permitted result of a constant expression if it is an object with <strong>static storage duration</strong> that is either not a temporary object or is a temporary object whose value satisfies the above constraints, or it is a\n  function.</p>\n</blockquote>\n<pre><code>void foo(){\n    const int a = 1;//a has automatic storage duration\n    int b[a]{};\n}\n</code></pre>\n<p>In <code>int b[a]{};</code>, <code>a</code> is an id-expression, <code>a</code> is a lvalue core constant expression. Is <code>a</code> a constant expression?</p>\n<hr>\n<p>This is a clarification of <a href=\"https://stackoverflow.com/questions/31527913/is-a-glvalue-integral-constant-expression-a-constant-expression\">Is a glvalue integral constant expression a constant expression?</a></p>\n</hr>", "Tags": "<c++><language-lawyer><constant-expression>", "OwnerUserId": "4958516", "AnswerCount": "1"}, "31537697": {"ParentId": "31537359", "CommentCount": "13", "CreationDate": "2015-07-21T11:24:16.560", "OwnerUserId": "743382", "PostTypeId": "2", "Id": "31537697", "Score": "3", "Body": "<p><code>a</code> can be a prvalue core constant expression, but not a glvalue core constant expression, nor should that be possible. You already found the wording in the standard, so perhaps it's better to explain why the rules are what they are.</p>\n<pre><code>void foo(){\n    const int a = 1;//a has automatic storage duration\n    static constexpr const int &amp;ra = a;// cannot possibly be valid\n}\n</code></pre>\n<p>This cannot be valid because it would require the address of <code>a</code> to be known before <code>foo</code> gets called, before there <em>is</em> any <code>a</code>.</p>\n<p>Your <code>int b[a]{};</code> is fine, because it's using <code>a</code> as a prvalue core constant expression: it doesn't care where <code>a</code> is stored, it merely cares what value it has.</p>\n", "LastActivityDate": "2015-07-21T11:24:16.560"}, "bq_ids": {"n4140": {"so_31537359_31537359_3": {"section_id": 6185, "quality": 0.625, "length": 5}, "so_31537359_31537359_4": {"section_id": 6185, "quality": 0.9230769230769231, "length": 12}, "so_31537359_31537359_7": {"section_id": 6187, "quality": 0.5833333333333334, "length": 7}, "so_31537359_31537359_6": {"section_id": 6187, "quality": 0.7142857142857143, "length": 20}, "so_31537359_31537359_2": {"section_id": 6185, "quality": 0.875, "length": 14}, "so_31537359_31537359_5": {"section_id": 6185, "quality": 0.9230769230769231, "length": 12}, "so_31537359_31537359_0": {"section_id": 6185, "quality": 0.9285714285714286, "length": 13}, "so_31537359_31537359_8": {"section_id": 6187, "quality": 1.0, "length": 20}}, "n3337": {"so_31537359_31537359_3": {"section_id": 5946, "quality": 0.625, "length": 5}, "so_31537359_31537359_2": {"section_id": 5946, "quality": 0.8125, "length": 13}, "so_31537359_31537359_5": {"section_id": 5946, "quality": 0.6923076923076923, "length": 9}, "so_31537359_31537359_4": {"section_id": 5946, "quality": 0.8461538461538461, "length": 11}, "so_31537359_31537359_8": {"section_id": 5947, "quality": 0.7, "length": 14}}, "n4659": {"so_31537359_31537359_7": {"section_id": 7690, "quality": 1.0, "length": 12}, "so_31537359_31537359_6": {"section_id": 7690, "quality": 0.7857142857142857, "length": 22}, "so_31537359_31537359_4": {"section_id": 7687, "quality": 0.9230769230769231, "length": 12}, "so_31537359_31537359_3": {"section_id": 7687, "quality": 0.75, "length": 6}, "so_31537359_31537359_9": {"section_id": 7690, "quality": 1.0, "length": 20}, "so_31537359_31537359_2": {"section_id": 7687, "quality": 0.9375, "length": 15}, "so_31537359_31537359_5": {"section_id": 7687, "quality": 0.9230769230769231, "length": 12}, "so_31537359_31537359_0": {"section_id": 7687, "quality": 0.7857142857142857, "length": 11}, "so_31537359_31537359_8": {"section_id": 7690, "quality": 0.95, "length": 19}}}});