post_cb({"1276847": {"ViewCount": "19372", "Body": "<p>I was checking the behavior of dynamic_cast and found that when it fails, std::bad_cast exception is thrown only if the destination is a reference type. If the destination is a pointer type then no exception is thrown from the cast. This is my sample code:</p>\n<pre><code>class A\n{\n    public:\n        virtual ~A()\n        {\n        }\n};\n\nclass B : public A\n{\n};\n\nint  main()\n{\n    A* p = new A;\n\n    //Using reference\n    try\n    {\n    B&amp; b = dynamic_cast&lt;B&amp;&gt;(*p);\n    }\n    catch(std::bad_cast exp)\n    {\n    std::cout&lt;&lt;\"Caught bad cast\\n\";\n    }\n\n    //Using pointer\n      try\n    {\n    B* pB = dynamic_cast&lt;B*&gt;(p);\n\n    if( pB == NULL)\n    {\n        std::cout&lt;&lt;\"NULL Pointer\\n\";\n    }\n    }\n    catch(std::bad_cast exp)\n    {\n    std::cout&lt;&lt;\"Caught bad cast\\n\";\n    }\n\n    return 0;\n}\n</code></pre>\n<p>Output is \"Caught bad cast\" and \"NULL pointer\". Code is compiled using VS2008. Is this the correct behavior ? If yes, then why there is a difference?</p>\n", "AcceptedAnswerId": "1276857", "Title": "Difference in behavior while using dynamic_cast with reference and pointers", "CreationDate": "2009-08-14T09:12:35.397", "Id": "1276847", "CommentCount": "0", "FavoriteCount": "8", "PostTypeId": "1", "LastEditDate": "2009-08-14T11:09:16.270", "LastEditorUserId": "57428", "LastActivityDate": "2009-08-14T11:09:16.270", "Score": "31", "OwnerUserId": "39742", "Tags": "<c++><casting><dynamic-cast>", "AnswerCount": "4"}, "1276873": {"Id": "1276873", "PostTypeId": "2", "Body": "<p>See the C++ Standard, section 5.2.7/9:</p>\n<blockquote>\n<p id=\"so_1276847_1276873_0\">9 The value of a failed cast to\n  pointer type is the null pointer value\n  of the required result type.  A failed\n  cast to reference type throws bad_cast\n  (18.5.2).</p>\n</blockquote>\n<p>As to why - these are Stroustrup's words from the D &amp; E book, section 14.2.2:</p>\n<blockquote>\n<p id=\"so_1276847_1276873_1\">I use a reference cast when I want an\n  assumption  about a reference type\n  checked and consider it a failure for\n  my assumption to be wrong. If instead\n  I want to select among plausible\n  alternatives, I use a pointer cast and\n  test the result.</p>\n</blockquote>\n", "LastEditorDisplayName": "anon", "OwnerDisplayName": "anon", "LastActivityDate": "2009-08-14T10:21:00.983", "Score": "17", "CreationDate": "2009-08-14T09:17:49.583", "ParentId": "1276847", "CommentCount": "1", "LastEditDate": "2009-08-14T10:21:00.983"}, "bq_ids": {"n4140": {"so_1276847_1276873_0": {"length": 16, "quality": 0.8421052631578947, "section_id": 6019}, "so_1276847_1276872_0": {"length": 16, "quality": 0.8421052631578947, "section_id": 6019}}, "n3337": {"so_1276847_1276873_0": {"length": 16, "quality": 0.8421052631578947, "section_id": 5787}, "so_1276847_1276872_0": {"length": 16, "quality": 0.8421052631578947, "section_id": 5787}}, "n4659": {"so_1276847_1276873_0": {"length": 16, "quality": 0.8421052631578947, "section_id": 7518}, "so_1276847_1276872_0": {"length": 16, "quality": 0.8421052631578947, "section_id": 7518}}}, "1276856": {"Id": "1276856", "PostTypeId": "2", "Body": "<p>Yes, it is. Because <code>dynamic_cast</code> can't return NULL for a failed reference cast, an exception is the only way out.</p>\n<p>That is, a reference can't be NULL, so there is nothing suitable to return.</p>\n", "LastActivityDate": "2009-08-14T09:14:34.877", "Score": "5", "CreationDate": "2009-08-14T09:14:34.877", "ParentId": "1276847", "CommentCount": "3", "OwnerUserId": "96963"}, "1276857": {"Id": "1276857", "PostTypeId": "2", "Body": "<p>Yes, this is correct behaviour. The reason is that you can have a null pointer, but not a null reference - any reference has to be bound to an object.</p>\n<p>So when dynamic_cast for a pointer type fails it returns a null pointer and the caller can check for that, but when it fails for a reference type it can't return a null reference, so an exception is the only reasonable way to signal a problem.</p>\n", "LastActivityDate": "2009-08-14T09:14:38.153", "Score": "56", "CreationDate": "2009-08-14T09:14:38.153", "ParentId": "1276847", "CommentCount": "0", "OwnerUserId": "57428"}, "1276872": {"Id": "1276872", "PostTypeId": "2", "Body": "<p>Yes, 5.2.7/9</p>\n<blockquote>\n<p id=\"so_1276847_1276872_0\">The value of a failed cast to pointer type is the null pointer value of the required result type.  A failed cast to reference type throws bad_cast (18.5.2).</p>\n</blockquote>\n", "LastActivityDate": "2009-08-14T09:17:42.407", "Score": "8", "CreationDate": "2009-08-14T09:17:42.407", "ParentId": "1276847", "CommentCount": "0", "OwnerUserId": "136208"}});